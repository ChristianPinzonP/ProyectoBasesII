--------------------------------------------------------
-- Archivo creado  - jueves-mayo-29-2025   
--------------------------------------------------------
--------------------------------------------------------
--  DDL for Type OPCION_RESPUESTA_OBJ
--------------------------------------------------------

  CREATE OR REPLACE NONEDITIONABLE TYPE "ROOT2"."OPCION_RESPUESTA_OBJ" AS OBJECT (
    id_respuesta NUMBER,
    texto       VARCHAR2(500),
    es_correcta VARCHAR2(1) -- 'S' o 'N'
);


/
--------------------------------------------------------
--  DDL for Type OPCION_RESPUESTA_TABLE
--------------------------------------------------------

  CREATE OR REPLACE NONEDITIONABLE TYPE "ROOT2"."OPCION_RESPUESTA_TABLE" AS TABLE OF OPCION_RESPUESTA_OBJ;


/
--------------------------------------------------------
--  DDL for Type TEMA_OBJ
--------------------------------------------------------

  CREATE OR REPLACE NONEDITIONABLE TYPE "ROOT2"."TEMA_OBJ" AS OBJECT (
    ID_TEMA  NUMBER,
    NOMBRE   VARCHAR2(255)
);


/
--------------------------------------------------------
--  DDL for Type TEMA_TABLA
--------------------------------------------------------

  CREATE OR REPLACE NONEDITIONABLE TYPE "ROOT2"."TEMA_TABLA" AS TABLE OF TEMA_OBJ;


/
--------------------------------------------------------
--  DDL for Sequence SEQ_EXAMEN
--------------------------------------------------------

   CREATE SEQUENCE  "ROOT2"."SEQ_EXAMEN"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 31 NOCACHE  NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_GRUPO
--------------------------------------------------------

   CREATE SEQUENCE  "ROOT2"."SEQ_GRUPO"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 5 NOCACHE  NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_ID_PREGUNTA
--------------------------------------------------------

   CREATE SEQUENCE  "ROOT2"."SEQ_ID_PREGUNTA"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 561 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_PREGUNTA
--------------------------------------------------------

   CREATE SEQUENCE  "ROOT2"."SEQ_PREGUNTA"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 241 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_PRESENTACION_EXAMEN
--------------------------------------------------------

   CREATE SEQUENCE  "ROOT2"."SEQ_PRESENTACION_EXAMEN"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 63 NOCACHE  NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_RESPUESTA
--------------------------------------------------------

   CREATE SEQUENCE  "ROOT2"."SEQ_RESPUESTA"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 361 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_RESPUESTA_ESTUDIANTE
--------------------------------------------------------

   CREATE SEQUENCE  "ROOT2"."SEQ_RESPUESTA_ESTUDIANTE"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 147 NOCACHE  NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_TEMA
--------------------------------------------------------

   CREATE SEQUENCE  "ROOT2"."SEQ_TEMA"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Table DOCENTE
--------------------------------------------------------

  CREATE TABLE "ROOT2"."DOCENTE" 
   (	"ID_DOCENTE" NUMBER, 
	"ASIGNATURA" VARCHAR2(100 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_USUARIOS" ;
--------------------------------------------------------
--  DDL for Table DOCENTE_GRUPO
--------------------------------------------------------

  CREATE TABLE "ROOT2"."DOCENTE_GRUPO" 
   (	"ID_DOCENTE" NUMBER, 
	"ID_GRUPO" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_USUARIOS" ;
--------------------------------------------------------
--  DDL for Table ESTADISTICAS_ESTUDIANTE
--------------------------------------------------------

  CREATE TABLE "ROOT2"."ESTADISTICAS_ESTUDIANTE" 
   (	"ID_ESTUDIANTE" NUMBER, 
	"TOTAL_EXAMENES_PRESENTADOS" NUMBER, 
	"PREGUNTAS_CORRECTAS" NUMBER, 
	"PREGUNTAS_INCORRECTAS" NUMBER, 
	"PROMEDIO_NOTA" NUMBER(5,2), 
	"MAX_NOTA" NUMBER(5,2), 
	"MIN_NOTA" NUMBER(5,2)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_ESTADISTICAS" ;
--------------------------------------------------------
--  DDL for Table ESTADISTICAS_EXAMEN
--------------------------------------------------------

  CREATE TABLE "ROOT2"."ESTADISTICAS_EXAMEN" 
   (	"ID_ESTADISTICA" NUMBER, 
	"ID_EXAMEN" NUMBER, 
	"TOTAL_PRESENTADOS" NUMBER, 
	"PROMEDIO_NOTA" NUMBER, 
	"MAX_NOTA" NUMBER, 
	"MIN_NOTA" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_ESTADISTICAS" ;
--------------------------------------------------------
--  DDL for Table ESTADISTICAS_GRUPO
--------------------------------------------------------

  CREATE TABLE "ROOT2"."ESTADISTICAS_GRUPO" 
   (	"ID_GRUPO" NUMBER, 
	"TOTAL_EXAMENES_PRESENTADOS" NUMBER, 
	"PROMEDIO_GENERAL" NUMBER(5,2), 
	"MAX_NOTA" NUMBER(5,2), 
	"MIN_NOTA" NUMBER(5,2)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_ESTADISTICAS" ;
--------------------------------------------------------
--  DDL for Table ESTADISTICAS_PREGUNTA
--------------------------------------------------------

  CREATE TABLE "ROOT2"."ESTADISTICAS_PREGUNTA" 
   (	"ID_PREGUNTA" NUMBER, 
	"PORCENTAJE_CORRECTAS" NUMBER, 
	"TOTAL_RESPUESTAS" NUMBER, 
	"CORRECTAS" NUMBER, 
	"INCORRECTAS" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_ESTADISTICAS" ;
--------------------------------------------------------
--  DDL for Table ESTADISTICAS_TEMA
--------------------------------------------------------

  CREATE TABLE "ROOT2"."ESTADISTICAS_TEMA" 
   (	"ID_TEMA" NUMBER, 
	"TOTAL_PREGUNTAS" NUMBER, 
	"TOTAL_CORRECTAS" NUMBER, 
	"TOTAL_INCORRECTAS" NUMBER, 
	"PROMEDIO_NOTA" NUMBER(5,2), 
	"MAX_NOTA" NUMBER(5,2), 
	"MIN_NOTA" NUMBER(5,2)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_ESTADISTICAS" ;
--------------------------------------------------------
--  DDL for Table ESTUDIANTE
--------------------------------------------------------

  CREATE TABLE "ROOT2"."ESTUDIANTE" 
   (	"ID_ESTUDIANTE" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_USUARIOS" ;
--------------------------------------------------------
--  DDL for Table ESTUDIANTE_GRUPO
--------------------------------------------------------

  CREATE TABLE "ROOT2"."ESTUDIANTE_GRUPO" 
   (	"ID_ESTUDIANTE" NUMBER, 
	"ID_GRUPO" NUMBER, 
	"ESTADO" VARCHAR2(20 BYTE) DEFAULT 'Activo'
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_USUARIOS" ;
--------------------------------------------------------
--  DDL for Table EXAMEN
--------------------------------------------------------

  CREATE TABLE "ROOT2"."EXAMEN" 
   (	"ID_EXAMEN" NUMBER DEFAULT "ROOT2"."SEQ_EXAMEN"."NEXTVAL", 
	"NOMBRE" VARCHAR2(100 BYTE), 
	"DESCRIPCION" VARCHAR2(255 BYTE), 
	"FECHA_INICIO" DATE, 
	"FECHA_FIN" DATE, 
	"TIEMPO_LIMITE" NUMBER, 
	"ID_DOCENTE" NUMBER, 
	"NUMERO_PREGUNTAS" NUMBER, 
	"MODO_SELECCION" VARCHAR2(20 BYTE), 
	"TIEMPO_POR_PREGUNTA" NUMBER, 
	"ID_TEMA" NUMBER, 
	"ID_GRUPO" NUMBER, 
	"NOTA_MINIMA_APROBACION" NUMBER(2,1) DEFAULT 3.0, 
	"ES_SIN_TIEMPO" NUMBER(1,0) DEFAULT 0, 
	"NUM_PREGUNTAS_ALEATORIAS" NUMBER, 
	"PESO_CURSO" NUMBER(5,2), 
	"INTENTOS_PERMITIDOS" NUMBER DEFAULT 1
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_EXAMENES" ;
--------------------------------------------------------
--  DDL for Table EXAMEN_PREGUNTA
--------------------------------------------------------

  CREATE TABLE "ROOT2"."EXAMEN_PREGUNTA" 
   (	"ID_EXAMEN" NUMBER, 
	"ID_PREGUNTA" NUMBER, 
	"VALOR_NOTA" NUMBER(3,2) DEFAULT 1.0
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_EXAMENES" ;
--------------------------------------------------------
--  DDL for Table GRUPO
--------------------------------------------------------

  CREATE TABLE "ROOT2"."GRUPO" 
   (	"ID_GRUPO" NUMBER, 
	"NOMBRE" VARCHAR2(100 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_USUARIOS" ;
--------------------------------------------------------
--  DDL for Table HORARIO
--------------------------------------------------------

  CREATE TABLE "ROOT2"."HORARIO" 
   (	"ID_HORARIO" NUMBER, 
	"ID_GRUPO" NUMBER, 
	"DIA_SEMANA" VARCHAR2(15 BYTE), 
	"HORA_INICIO" DATE, 
	"HORA_FIN" DATE, 
	"LUGAR" VARCHAR2(100 BYTE)
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "TBS_PLANESTUDIO" ;
--------------------------------------------------------
--  DDL for Table PLAN_ESTUDIO
--------------------------------------------------------

  CREATE TABLE "ROOT2"."PLAN_ESTUDIO" 
   (	"ID_PLAN" NUMBER, 
	"ID_GRUPO" NUMBER, 
	"VERSION_PLAN" VARCHAR2(10 BYTE), 
	"DESCRIPCION" VARCHAR2(200 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_PLANESTUDIO" ;
--------------------------------------------------------
--  DDL for Table PREGUNTA
--------------------------------------------------------

  CREATE TABLE "ROOT2"."PREGUNTA" 
   (	"ID_PREGUNTA" NUMBER DEFAULT "ROOT2"."SEQ_PREGUNTA"."NEXTVAL", 
	"TEXTO" CLOB, 
	"TIPO" VARCHAR2(50 BYTE), 
	"ID_TEMA" NUMBER, 
	"VALOR_NOTA" NUMBER(3,2) DEFAULT 0, 
	"ID_DOCENTE" NUMBER, 
	"ES_PUBLICA" CHAR(1 BYTE) DEFAULT 'N', 
	"ID_PREGUNTA_PADRE" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_EXAMENES" 
 LOB ("TEXTO") STORE AS SECUREFILE (
  TABLESPACE "TBS_LOB" ENABLE STORAGE IN ROW CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) ;
--------------------------------------------------------
--  DDL for Table PRESENTACION_EXAMEN
--------------------------------------------------------

  CREATE TABLE "ROOT2"."PRESENTACION_EXAMEN" 
   (	"ID_PRESENTACION" NUMBER, 
	"ID_EXAMEN" NUMBER, 
	"ID_ESTUDIANTE" NUMBER, 
	"FECHA_PRESENTACION" DATE, 
	"CALIFICACION" NUMBER, 
	"FECHA_HORA_FIN" DATE, 
	"FECHA_HORA_INICIO" DATE, 
	"ESTADO" VARCHAR2(20 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_PRESENTACION" ;
--------------------------------------------------------
--  DDL for Table RESPUESTA
--------------------------------------------------------

  CREATE TABLE "ROOT2"."RESPUESTA" 
   (	"ID_RESPUESTA" NUMBER, 
	"ID_PREGUNTA" NUMBER, 
	"TEXTO" VARCHAR2(255 BYTE), 
	"ES_CORRECTA" VARCHAR2(1 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_EXAMENES" ;
--------------------------------------------------------
--  DDL for Table RESPUESTA_ESTUDIANTE
--------------------------------------------------------

  CREATE TABLE "ROOT2"."RESPUESTA_ESTUDIANTE" 
   (	"ID_RESPUESTA_ESTUDIANTE" NUMBER, 
	"ID_PRESENTACION" NUMBER, 
	"ID_PREGUNTA" NUMBER, 
	"ID_RESPUESTA" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_PRESENTACION" ;
--------------------------------------------------------
--  DDL for Table TEMA
--------------------------------------------------------

  CREATE TABLE "ROOT2"."TEMA" 
   (	"ID_TEMA" NUMBER, 
	"NOMBRE" VARCHAR2(100 BYTE), 
	"ID_UNIDAD" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_PLANESTUDIO" ;
--------------------------------------------------------
--  DDL for Table UNIDAD
--------------------------------------------------------

  CREATE TABLE "ROOT2"."UNIDAD" 
   (	"ID_UNIDAD" NUMBER, 
	"ID_PLAN" NUMBER, 
	"NOMBRE" VARCHAR2(100 BYTE), 
	"DESCRIPCION" VARCHAR2(200 BYTE), 
	"ORDEN" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_PLANESTUDIO" ;
--------------------------------------------------------
--  DDL for Table USUARIO
--------------------------------------------------------

  CREATE TABLE "ROOT2"."USUARIO" 
   (	"ID_USUARIO" NUMBER, 
	"NOMBRE" VARCHAR2(100 BYTE), 
	"CORREO" VARCHAR2(100 BYTE), 
	"CONTRASENA" VARCHAR2(100 BYTE), 
	"TIPO_USUARIO" VARCHAR2(20 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_USUARIOS" ;
--------------------------------------------------------
--  DDL for View VISTA_ESTADISTICAS_ESTUDIANTE
--------------------------------------------------------

  CREATE OR REPLACE FORCE NONEDITIONABLE VIEW "ROOT2"."VISTA_ESTADISTICAS_ESTUDIANTE" ("ID_ESTUDIANTE", "NOMBRE", "TOTAL_EXAMENES_PRESENTADOS", "TOTAL_RESPUESTAS", "PREGUNTAS_CORRECTAS", "PREGUNTAS_INCORRECTAS", "PROMEDIO_NOTA", "MAX_NOTA", "MIN_NOTA") AS 
  SELECT 
    e.id_estudiante AS id_estudiante,
    u.nombre AS nombre,
    COUNT(DISTINCT pres.id_presentacion) AS total_examenes_presentados,
    COUNT(res_est.id_respuesta_estudiante) AS total_respuestas,
    SUM(CASE WHEN r.es_correcta = 'S' THEN 1 ELSE 0 END) AS preguntas_correctas,
    SUM(CASE WHEN r.es_correcta = 'N' THEN 1 ELSE 0 END) AS preguntas_incorrectas,
    ROUND(AVG(pres.calificacion), 2) AS promedio_nota,
    MAX(pres.calificacion) AS max_nota,
    MIN(pres.calificacion) AS min_nota
FROM 
    ESTUDIANTE e
JOIN 
    USUARIO u ON u.id_usuario = e.id_estudiante
JOIN 
    PRESENTACION_EXAMEN pres ON pres.id_estudiante = e.id_estudiante
LEFT JOIN 
    RESPUESTA_ESTUDIANTE res_est ON res_est.id_presentacion = pres.id_presentacion
LEFT JOIN 
    RESPUESTA r ON r.id_respuesta = res_est.id_respuesta
GROUP BY 
    e.id_estudiante, u.nombre
;
--------------------------------------------------------
--  DDL for View VISTA_ESTADISTICAS_EXAMEN
--------------------------------------------------------

  CREATE OR REPLACE FORCE NONEDITIONABLE VIEW "ROOT2"."VISTA_ESTADISTICAS_EXAMEN" ("ID_EXAMEN", "NOMBRE", "TOTAL_PRESENTACIONES", "PROMEDIO_NOTA", "MAX_NOTA", "MIN_NOTA") AS 
  SELECT 
    e.id_examen,
    e.nombre,
    COUNT(pres.id_presentacion) AS total_presentaciones,
    ROUND(AVG(pres.calificacion), 2) AS promedio_nota,
    MAX(pres.calificacion) AS max_nota,
    MIN(pres.calificacion) AS min_nota
FROM 
    EXAMEN e
LEFT JOIN 
    PRESENTACION_EXAMEN pres ON pres.id_examen = e.id_examen
GROUP BY 
    e.id_examen, e.nombre
;
--------------------------------------------------------
--  DDL for View VISTA_ESTADISTICAS_GRUPO
--------------------------------------------------------

  CREATE OR REPLACE FORCE NONEDITIONABLE VIEW "ROOT2"."VISTA_ESTADISTICAS_GRUPO" ("ID_GRUPO", "GRUPO", "TOTAL_EXAMENES_PRESENTADOS", "PROMEDIO_GENERAL", "MAX_NOTA", "MIN_NOTA") AS 
  SELECT 
    g.id_grupo,
    g.nombre AS grupo,
    COUNT(DISTINCT pres.id_presentacion) AS total_examenes_presentados,
    ROUND(AVG(pres.calificacion), 2) AS promedio_general,
    MAX(pres.calificacion) AS max_nota,
    MIN(pres.calificacion) AS min_nota
FROM 
    GRUPO g
JOIN 
    ESTUDIANTE_GRUPO eg ON eg.id_grupo = g.id_grupo
JOIN 
    PRESENTACION_EXAMEN pres ON pres.id_estudiante = eg.id_estudiante
GROUP BY 
    g.id_grupo, g.nombre
;
--------------------------------------------------------
--  DDL for View VISTA_ESTADISTICAS_PREGUNTA
--------------------------------------------------------

  CREATE OR REPLACE FORCE NONEDITIONABLE VIEW "ROOT2"."VISTA_ESTADISTICAS_PREGUNTA" ("ID_PREGUNTA", "PREGUNTA", "TEMA", "TOTAL_RESPUESTAS", "TOTAL_CORRECTAS", "TOTAL_INCORRECTAS", "PORCENTAJE_ACIERTOS") AS 
  SELECT 
    p.id_pregunta,
    DBMS_LOB.SUBSTR(p.texto, 4000, 1) AS pregunta,
    t.nombre AS tema,
    COUNT(re.id_respuesta_estudiante) AS total_respuestas,
    SUM(CASE WHEN r.es_correcta = 'S' THEN 1 ELSE 0 END) AS total_correctas,
    SUM(CASE WHEN r.es_correcta = 'N' THEN 1 ELSE 0 END) AS total_incorrectas,
    ROUND(
        CASE 
            WHEN COUNT(re.id_respuesta_estudiante) = 0 THEN 0
            ELSE 
                (SUM(CASE WHEN r.es_correcta = 'S' THEN 1 ELSE 0 END) * 100.0) / COUNT(re.id_respuesta_estudiante)
        END
    , 2) AS porcentaje_aciertos
FROM 
    PREGUNTA p
JOIN 
    TEMA t ON t.id_tema = p.id_tema
LEFT JOIN 
    RESPUESTA_ESTUDIANTE re ON re.id_pregunta = p.id_pregunta
LEFT JOIN 
    RESPUESTA r ON r.id_respuesta = re.id_respuesta
GROUP BY 
    p.id_pregunta, DBMS_LOB.SUBSTR(p.texto, 4000, 1), t.nombre
;
--------------------------------------------------------
--  DDL for View VISTA_ESTADISTICAS_TEMA
--------------------------------------------------------

  CREATE OR REPLACE FORCE NONEDITIONABLE VIEW "ROOT2"."VISTA_ESTADISTICAS_TEMA" ("ID_TEMA", "TEMA", "TOTAL_RESPUESTAS", "TOTAL_CORRECTAS", "TOTAL_INCORRECTAS", "PROMEDIO_NOTA", "MAX_NOTA", "MIN_NOTA") AS 
  SELECT 
    t.id_tema,
    t.nombre AS tema,
    COUNT(re.id_respuesta_estudiante) AS total_respuestas,
    SUM(CASE WHEN pe.es_correcta = 'S' THEN 1 ELSE 0 END) AS total_correctas,
    SUM(CASE WHEN pe.es_correcta = 'N' THEN 1 ELSE 0 END) AS total_incorrectas,
    ROUND(AVG(pres.calificacion), 2) AS promedio_nota,
    MAX(pres.calificacion) AS max_nota,
    MIN(pres.calificacion) AS min_nota
FROM 
    TEMA t
JOIN 
    PREGUNTA p ON p.id_tema = t.id_tema
JOIN 
    RESPUESTA pe ON pe.id_pregunta = p.id_pregunta
JOIN 
    RESPUESTA_ESTUDIANTE re ON re.id_respuesta = pe.id_respuesta
JOIN
    PRESENTACION_EXAMEN pres ON pres.id_presentacion = re.id_presentacion
GROUP BY 
    t.id_tema, t.nombre
;
REM INSERTING into ROOT2.DOCENTE
SET DEFINE OFF;
Insert into ROOT2.DOCENTE (ID_DOCENTE,ASIGNATURA) values ('1','Bases de Datos');
Insert into ROOT2.DOCENTE (ID_DOCENTE,ASIGNATURA) values ('6',null);
Insert into ROOT2.DOCENTE (ID_DOCENTE,ASIGNATURA) values ('2001','Programación');
REM INSERTING into ROOT2.DOCENTE_GRUPO
SET DEFINE OFF;
Insert into ROOT2.DOCENTE_GRUPO (ID_DOCENTE,ID_GRUPO) values ('1','1');
Insert into ROOT2.DOCENTE_GRUPO (ID_DOCENTE,ID_GRUPO) values ('1','2');
Insert into ROOT2.DOCENTE_GRUPO (ID_DOCENTE,ID_GRUPO) values ('1','3');
Insert into ROOT2.DOCENTE_GRUPO (ID_DOCENTE,ID_GRUPO) values ('1','4');
Insert into ROOT2.DOCENTE_GRUPO (ID_DOCENTE,ID_GRUPO) values ('6','5');
Insert into ROOT2.DOCENTE_GRUPO (ID_DOCENTE,ID_GRUPO) values ('2001','10');
REM INSERTING into ROOT2.ESTADISTICAS_ESTUDIANTE
SET DEFINE OFF;
Insert into ROOT2.ESTADISTICAS_ESTUDIANTE (ID_ESTUDIANTE,TOTAL_EXAMENES_PRESENTADOS,PREGUNTAS_CORRECTAS,PREGUNTAS_INCORRECTAS,PROMEDIO_NOTA,MAX_NOTA,MIN_NOTA) values ('2','1','1','1','3,33','3,33','3,33');
Insert into ROOT2.ESTADISTICAS_ESTUDIANTE (ID_ESTUDIANTE,TOTAL_EXAMENES_PRESENTADOS,PREGUNTAS_CORRECTAS,PREGUNTAS_INCORRECTAS,PROMEDIO_NOTA,MAX_NOTA,MIN_NOTA) values ('1009','1','2','0','5','5','5');
Insert into ROOT2.ESTADISTICAS_ESTUDIANTE (ID_ESTUDIANTE,TOTAL_EXAMENES_PRESENTADOS,PREGUNTAS_CORRECTAS,PREGUNTAS_INCORRECTAS,PROMEDIO_NOTA,MAX_NOTA,MIN_NOTA) values ('1002','2','2','5','2,14','5','1');
Insert into ROOT2.ESTADISTICAS_ESTUDIANTE (ID_ESTUDIANTE,TOTAL_EXAMENES_PRESENTADOS,PREGUNTAS_CORRECTAS,PREGUNTAS_INCORRECTAS,PROMEDIO_NOTA,MAX_NOTA,MIN_NOTA) values ('1001','2','3','3','3,33','5','0');
REM INSERTING into ROOT2.ESTADISTICAS_EXAMEN
SET DEFINE OFF;
Insert into ROOT2.ESTADISTICAS_EXAMEN (ID_ESTADISTICA,ID_EXAMEN,TOTAL_PRESENTADOS,PROMEDIO_NOTA,MAX_NOTA,MIN_NOTA) values ('521','23','5','3,33','5','0');
Insert into ROOT2.ESTADISTICAS_EXAMEN (ID_ESTADISTICA,ID_EXAMEN,TOTAL_PRESENTADOS,PROMEDIO_NOTA,MAX_NOTA,MIN_NOTA) values ('522','14','1','1','1','1');
Insert into ROOT2.ESTADISTICAS_EXAMEN (ID_ESTADISTICA,ID_EXAMEN,TOTAL_PRESENTADOS,PROMEDIO_NOTA,MAX_NOTA,MIN_NOTA) values ('523','29','1','5','5','5');
Insert into ROOT2.ESTADISTICAS_EXAMEN (ID_ESTADISTICA,ID_EXAMEN,TOTAL_PRESENTADOS,PROMEDIO_NOTA,MAX_NOTA,MIN_NOTA) values ('524','24','2','0','0','0');
Insert into ROOT2.ESTADISTICAS_EXAMEN (ID_ESTADISTICA,ID_EXAMEN,TOTAL_PRESENTADOS,PROMEDIO_NOTA,MAX_NOTA,MIN_NOTA) values ('525','25','1','3,33','3,33','3,33');
REM INSERTING into ROOT2.ESTADISTICAS_GRUPO
SET DEFINE OFF;
Insert into ROOT2.ESTADISTICAS_GRUPO (ID_GRUPO,TOTAL_EXAMENES_PRESENTADOS,PROMEDIO_GENERAL,MAX_NOTA,MIN_NOTA) values ('1','1','3,33','3,33','3,33');
Insert into ROOT2.ESTADISTICAS_GRUPO (ID_GRUPO,TOTAL_EXAMENES_PRESENTADOS,PROMEDIO_GENERAL,MAX_NOTA,MIN_NOTA) values ('2','8','2,2','5','0');
Insert into ROOT2.ESTADISTICAS_GRUPO (ID_GRUPO,TOTAL_EXAMENES_PRESENTADOS,PROMEDIO_GENERAL,MAX_NOTA,MIN_NOTA) values ('4','1','5','5','5');
REM INSERTING into ROOT2.ESTADISTICAS_PREGUNTA
SET DEFINE OFF;
Insert into ROOT2.ESTADISTICAS_PREGUNTA (ID_PREGUNTA,PORCENTAJE_CORRECTAS,TOTAL_RESPUESTAS,CORRECTAS,INCORRECTAS) values ('463','33,33','3','1','2');
Insert into ROOT2.ESTADISTICAS_PREGUNTA (ID_PREGUNTA,PORCENTAJE_CORRECTAS,TOTAL_RESPUESTAS,CORRECTAS,INCORRECTAS) values ('501','100','1','1','0');
Insert into ROOT2.ESTADISTICAS_PREGUNTA (ID_PREGUNTA,PORCENTAJE_CORRECTAS,TOTAL_RESPUESTAS,CORRECTAS,INCORRECTAS) values ('481','100','2','2','0');
Insert into ROOT2.ESTADISTICAS_PREGUNTA (ID_PREGUNTA,PORCENTAJE_CORRECTAS,TOTAL_RESPUESTAS,CORRECTAS,INCORRECTAS) values ('441','0','1','0','1');
Insert into ROOT2.ESTADISTICAS_PREGUNTA (ID_PREGUNTA,PORCENTAJE_CORRECTAS,TOTAL_RESPUESTAS,CORRECTAS,INCORRECTAS) values ('482','50','2','1','1');
Insert into ROOT2.ESTADISTICAS_PREGUNTA (ID_PREGUNTA,PORCENTAJE_CORRECTAS,TOTAL_RESPUESTAS,CORRECTAS,INCORRECTAS) values ('383','0','1','0','1');
Insert into ROOT2.ESTADISTICAS_PREGUNTA (ID_PREGUNTA,PORCENTAJE_CORRECTAS,TOTAL_RESPUESTAS,CORRECTAS,INCORRECTAS) values ('381','100','1','1','0');
Insert into ROOT2.ESTADISTICAS_PREGUNTA (ID_PREGUNTA,PORCENTAJE_CORRECTAS,TOTAL_RESPUESTAS,CORRECTAS,INCORRECTAS) values ('361','0','1','0','1');
Insert into ROOT2.ESTADISTICAS_PREGUNTA (ID_PREGUNTA,PORCENTAJE_CORRECTAS,TOTAL_RESPUESTAS,CORRECTAS,INCORRECTAS) values ('382','0','1','0','1');
Insert into ROOT2.ESTADISTICAS_PREGUNTA (ID_PREGUNTA,PORCENTAJE_CORRECTAS,TOTAL_RESPUESTAS,CORRECTAS,INCORRECTAS) values ('388','0','1','0','1');
Insert into ROOT2.ESTADISTICAS_PREGUNTA (ID_PREGUNTA,PORCENTAJE_CORRECTAS,TOTAL_RESPUESTAS,CORRECTAS,INCORRECTAS) values ('461','66,67','3','2','1');
REM INSERTING into ROOT2.ESTADISTICAS_TEMA
SET DEFINE OFF;
Insert into ROOT2.ESTADISTICAS_TEMA (ID_TEMA,TOTAL_PREGUNTAS,TOTAL_CORRECTAS,TOTAL_INCORRECTAS,PROMEDIO_NOTA,MAX_NOTA,MIN_NOTA) values ('1','9','4','5','2,41','5','1');
Insert into ROOT2.ESTADISTICAS_TEMA (ID_TEMA,TOTAL_PREGUNTAS,TOTAL_CORRECTAS,TOTAL_INCORRECTAS,PROMEDIO_NOTA,MAX_NOTA,MIN_NOTA) values ('2','4','2','2','2,5','5','0');
Insert into ROOT2.ESTADISTICAS_TEMA (ID_TEMA,TOTAL_PREGUNTAS,TOTAL_CORRECTAS,TOTAL_INCORRECTAS,PROMEDIO_NOTA,MAX_NOTA,MIN_NOTA) values ('10','4','2','2','5','5','5');
REM INSERTING into ROOT2.ESTUDIANTE
SET DEFINE OFF;
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('2');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('3');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('4');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('5');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('1001');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('1002');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('1003');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('1004');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('1005');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('1006');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('1007');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('1008');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('1009');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('1010');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('1011');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('1012');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('2002');
Insert into ROOT2.ESTUDIANTE (ID_ESTUDIANTE) values ('2003');
REM INSERTING into ROOT2.ESTUDIANTE_GRUPO
SET DEFINE OFF;
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('1002','2','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('1007','3','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('1011','4','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('1009','4','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('1004','2','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('1008','3','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('1010','4','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('1006','3','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('1001','2','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('1005','3','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('1003','2','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('1012','4','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('2','1','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('3','1','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('4','1','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('5','1','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('2002','10','ACTIVO');
Insert into ROOT2.ESTUDIANTE_GRUPO (ID_ESTUDIANTE,ID_GRUPO,ESTADO) values ('2003','10','ACTIVO');
REM INSERTING into ROOT2.EXAMEN
SET DEFINE OFF;
Insert into ROOT2.EXAMEN (ID_EXAMEN,NOMBRE,DESCRIPCION,FECHA_INICIO,FECHA_FIN,TIEMPO_LIMITE,ID_DOCENTE,NUMERO_PREGUNTAS,MODO_SELECCION,TIEMPO_POR_PREGUNTA,ID_TEMA,ID_GRUPO,NOTA_MINIMA_APROBACION,ES_SIN_TIEMPO,NUM_PREGUNTAS_ALEATORIAS,PESO_CURSO,INTENTOS_PERMITIDOS) values ('14','Examen para Grupo B','examenGB',to_date('17/05/25','DD/MM/RR'),to_date('27/05/25','DD/MM/RR'),'20','1','3','Manual','4','2','2','3','0',null,null,'1');
Insert into ROOT2.EXAMEN (ID_EXAMEN,NOMBRE,DESCRIPCION,FECHA_INICIO,FECHA_FIN,TIEMPO_LIMITE,ID_DOCENTE,NUMERO_PREGUNTAS,MODO_SELECCION,TIEMPO_POR_PREGUNTA,ID_TEMA,ID_GRUPO,NOTA_MINIMA_APROBACION,ES_SIN_TIEMPO,NUM_PREGUNTAS_ALEATORIAS,PESO_CURSO,INTENTOS_PERMITIDOS) values ('24','Prueba examen intentos','prueba',to_date('25/05/25','DD/MM/RR'),to_date('26/05/25','DD/MM/RR'),'10','1','2','Aleatorio','5','2','2','3','0',null,null,'2');
Insert into ROOT2.EXAMEN (ID_EXAMEN,NOMBRE,DESCRIPCION,FECHA_INICIO,FECHA_FIN,TIEMPO_LIMITE,ID_DOCENTE,NUMERO_PREGUNTAS,MODO_SELECCION,TIEMPO_POR_PREGUNTA,ID_TEMA,ID_GRUPO,NOTA_MINIMA_APROBACION,ES_SIN_TIEMPO,NUM_PREGUNTAS_ALEATORIAS,PESO_CURSO,INTENTOS_PERMITIDOS) values ('23','Prueba b','prueba b',to_date('25/05/25','DD/MM/RR'),to_date('31/05/25','DD/MM/RR'),'10','1','2','Manual','5','2','2','3','0',null,null,'2');
Insert into ROOT2.EXAMEN (ID_EXAMEN,NOMBRE,DESCRIPCION,FECHA_INICIO,FECHA_FIN,TIEMPO_LIMITE,ID_DOCENTE,NUMERO_PREGUNTAS,MODO_SELECCION,TIEMPO_POR_PREGUNTA,ID_TEMA,ID_GRUPO,NOTA_MINIMA_APROBACION,ES_SIN_TIEMPO,NUM_PREGUNTAS_ALEATORIAS,PESO_CURSO,INTENTOS_PERMITIDOS) values ('28','prueba mixto','probando asignar preguntas aleatorias',to_date('28/05/25','DD/MM/RR'),to_date('31/05/25','DD/MM/RR'),'30','1','3','Mixto','10','2','3','3','0',null,null,'2');
Insert into ROOT2.EXAMEN (ID_EXAMEN,NOMBRE,DESCRIPCION,FECHA_INICIO,FECHA_FIN,TIEMPO_LIMITE,ID_DOCENTE,NUMERO_PREGUNTAS,MODO_SELECCION,TIEMPO_POR_PREGUNTA,ID_TEMA,ID_GRUPO,NOTA_MINIMA_APROBACION,ES_SIN_TIEMPO,NUM_PREGUNTAS_ALEATORIAS,PESO_CURSO,INTENTOS_PERMITIDOS) values ('25','Prueba GRUPO A','prueba',to_date('25/05/25','DD/MM/RR'),to_date('31/05/25','DD/MM/RR'),'30','1','2','Aleatorio','10','1','1','3','0',null,null,'1');
Insert into ROOT2.EXAMEN (ID_EXAMEN,NOMBRE,DESCRIPCION,FECHA_INICIO,FECHA_FIN,TIEMPO_LIMITE,ID_DOCENTE,NUMERO_PREGUNTAS,MODO_SELECCION,TIEMPO_POR_PREGUNTA,ID_TEMA,ID_GRUPO,NOTA_MINIMA_APROBACION,ES_SIN_TIEMPO,NUM_PREGUNTAS_ALEATORIAS,PESO_CURSO,INTENTOS_PERMITIDOS) values ('30','mineria de datos','probando',to_date('29/05/25','DD/MM/RR'),to_date('30/05/25','DD/MM/RR'),'40','1','3','Aleatorio','8','10','1','3','0',null,null,'2');
Insert into ROOT2.EXAMEN (ID_EXAMEN,NOMBRE,DESCRIPCION,FECHA_INICIO,FECHA_FIN,TIEMPO_LIMITE,ID_DOCENTE,NUMERO_PREGUNTAS,MODO_SELECCION,TIEMPO_POR_PREGUNTA,ID_TEMA,ID_GRUPO,NOTA_MINIMA_APROBACION,ES_SIN_TIEMPO,NUM_PREGUNTAS_ALEATORIAS,PESO_CURSO,INTENTOS_PERMITIDOS) values ('29','probar nota','probandoo',to_date('28/05/25','DD/MM/RR'),to_date('31/05/25','DD/MM/RR'),'20','1','2','Manual','10','10','4','3','0',null,null,'1');
Insert into ROOT2.EXAMEN (ID_EXAMEN,NOMBRE,DESCRIPCION,FECHA_INICIO,FECHA_FIN,TIEMPO_LIMITE,ID_DOCENTE,NUMERO_PREGUNTAS,MODO_SELECCION,TIEMPO_POR_PREGUNTA,ID_TEMA,ID_GRUPO,NOTA_MINIMA_APROBACION,ES_SIN_TIEMPO,NUM_PREGUNTAS_ALEATORIAS,PESO_CURSO,INTENTOS_PERMITIDOS) values ('100','Examen de Programación Básica','Evalúa conceptos introductorios',to_date('29/05/25','DD/MM/RR'),to_date('05/06/25','DD/MM/RR'),'30','2001','2','Manual','5','100','10','3','0',null,'20','2');
REM INSERTING into ROOT2.EXAMEN_PREGUNTA
SET DEFINE OFF;
Insert into ROOT2.EXAMEN_PREGUNTA (ID_EXAMEN,ID_PREGUNTA,VALOR_NOTA) values ('23','441','1');
Insert into ROOT2.EXAMEN_PREGUNTA (ID_EXAMEN,ID_PREGUNTA,VALOR_NOTA) values ('23','461','2');
Insert into ROOT2.EXAMEN_PREGUNTA (ID_EXAMEN,ID_PREGUNTA,VALOR_NOTA) values ('25','482','1');
Insert into ROOT2.EXAMEN_PREGUNTA (ID_EXAMEN,ID_PREGUNTA,VALOR_NOTA) values ('25','481','2');
Insert into ROOT2.EXAMEN_PREGUNTA (ID_EXAMEN,ID_PREGUNTA,VALOR_NOTA) values ('29','501','1');
Insert into ROOT2.EXAMEN_PREGUNTA (ID_EXAMEN,ID_PREGUNTA,VALOR_NOTA) values ('29','462','3');
Insert into ROOT2.EXAMEN_PREGUNTA (ID_EXAMEN,ID_PREGUNTA,VALOR_NOTA) values ('30','501','1');
Insert into ROOT2.EXAMEN_PREGUNTA (ID_EXAMEN,ID_PREGUNTA,VALOR_NOTA) values ('30','462','3');
Insert into ROOT2.EXAMEN_PREGUNTA (ID_EXAMEN,ID_PREGUNTA,VALOR_NOTA) values ('30','463','3');
REM INSERTING into ROOT2.GRUPO
SET DEFINE OFF;
Insert into ROOT2.GRUPO (ID_GRUPO,NOMBRE) values ('1','Grupo A');
Insert into ROOT2.GRUPO (ID_GRUPO,NOMBRE) values ('2','Grupo B');
Insert into ROOT2.GRUPO (ID_GRUPO,NOMBRE) values ('3','Grupo C');
Insert into ROOT2.GRUPO (ID_GRUPO,NOMBRE) values ('4','Grupo D');
Insert into ROOT2.GRUPO (ID_GRUPO,NOMBRE) values ('5','Bases de Datos');
Insert into ROOT2.GRUPO (ID_GRUPO,NOMBRE) values ('10','Grupo X');
REM INSERTING into ROOT2.HORARIO
SET DEFINE OFF;
REM INSERTING into ROOT2.PLAN_ESTUDIO
SET DEFINE OFF;
Insert into ROOT2.PLAN_ESTUDIO (ID_PLAN,ID_GRUPO,VERSION_PLAN,DESCRIPCION) values ('1','10','2025A','Plan inicial');
REM INSERTING into ROOT2.PREGUNTA
SET DEFINE OFF;
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('501','Opción Múltiple','10','1','1','N','462');
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('381','Verdadero/Falso','1','3',null,'N',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('382','Opci?n M?ltiple','1','1',null,'N',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('383','Opci?n M?ltiple','1','2',null,'N',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('384','Opci?n M?ltiple','1','1',null,'N',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('385','Respuesta Corta','1','1',null,'N',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('386','Respuesta Corta','1','2,2',null,'N',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('387','Respuesta Corta','1','0,5',null,'N',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('388','Verdadero/Falso','1','1,5',null,'N',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('461','Verdadero/Falso','2','2','1','S',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('463','Verdadero/Falso','10','3','1','S','462');
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('462','Compuesta','10','3','1','S',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('441','Verdadero/Falso','2','1','1','S',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('361','Verdadero/Falso','1','1',null,'N',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('401','Respuesta Corta','1','2',null,'N',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('481','Verdadero/Falso','1','2','1','N',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('482','Verdadero/Falso','1','1','1','S',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('543','Opción Múltiple','100','1','2001','S',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('544','Respuesta Corta','101','2','2001','S',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('545','Opción Múltiple','100','1','2001','S',null);
Insert into ROOT2.PREGUNTA (ID_PREGUNTA,TIPO,ID_TEMA,VALOR_NOTA,ID_DOCENTE,ES_PUBLICA,ID_PREGUNTA_PADRE) values ('546','Respuesta Corta','101','2','2001','S',null);
REM INSERTING into ROOT2.PRESENTACION_EXAMEN
SET DEFINE OFF;
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('49','23','1002',to_date('25/05/25','DD/MM/RR'),null,null,null,null);
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('50','24','1002',to_date('25/05/25','DD/MM/RR'),'0',null,null,'FINALIZADO');
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('51','24','1002',to_date('25/05/25','DD/MM/RR'),null,null,null,null);
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('46','23','1002',to_date('25/05/25','DD/MM/RR'),'5',null,null,'FINALIZADO');
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('47','14','1002',to_date('25/05/25','DD/MM/RR'),'1',null,null,'FINALIZADO');
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('48','23','1001',to_date('25/05/25','DD/MM/RR'),'5',null,null,'FINALIZADO');
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('58','29','1012',null,'0',to_date('29/05/25','DD/MM/RR'),to_date('29/05/25','DD/MM/RR'),'FINALIZADO');
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('62','30','3',null,'3,75',to_date('29/05/25','DD/MM/RR'),to_date('29/05/25','DD/MM/RR'),'FINALIZADO');
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('52','23','1001',to_date('28/05/25','DD/MM/RR'),null,null,null,null);
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('53','23','1001',to_date('28/05/25','DD/MM/RR'),'0',null,null,'FINALIZADO');
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('54','25','2',null,'3,33',to_date('28/05/25','DD/MM/RR'),to_date('28/05/25','DD/MM/RR'),'FINALIZADO');
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('55','29','1009',null,'5',to_date('28/05/25','DD/MM/RR'),to_date('28/05/25','DD/MM/RR'),'FINALIZADO');
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('56','29','1011',null,'0',to_date('29/05/25','DD/MM/RR'),to_date('29/05/25','DD/MM/RR'),'FINALIZADO');
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('57','29','1010',null,'0',to_date('29/05/25','DD/MM/RR'),to_date('29/05/25','DD/MM/RR'),'FINALIZADO');
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('59','28','1006',null,null,to_date('29/05/25','DD/MM/RR'),to_date('29/05/25','DD/MM/RR'),null);
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('60','30','2',null,'5',to_date('29/05/25','DD/MM/RR'),to_date('29/05/25','DD/MM/RR'),'FINALIZADO');
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('61','30','2',null,'5',to_date('29/05/25','DD/MM/RR'),to_date('29/05/25','DD/MM/RR'),'FINALIZADO');
Insert into ROOT2.PRESENTACION_EXAMEN (ID_PRESENTACION,ID_EXAMEN,ID_ESTUDIANTE,FECHA_PRESENTACION,CALIFICACION,FECHA_HORA_FIN,FECHA_HORA_INICIO,ESTADO) values ('5001','100','2002',to_date('29/05/25','DD/MM/RR'),null,null,null,'EN CURSO');
REM INSERTING into ROOT2.RESPUESTA
SET DEFINE OFF;
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('315','461','Verdadero','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('316','461','Falso','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('242','461','Falso','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('241','461','Verdadero','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('261','463','Verdadero','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('262','463','Falso','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('327','461','Verdadero','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('328','461','Falso','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('165','361','Verdadero','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('166','361','Falso','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('167','384','Clave secundaria','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('168','384','Clave externa','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('169','384','Clave primaria','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('170','384','Clave de texto','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('144','387','DROP TABLE','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('183','387','DELETE TABLE','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('281','481','Verdadero','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('142','388','Verdadero','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('143','388','Falso','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('141','401','Lenguaje','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('145','386','MYSQL','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('146','385','INSERT INTO','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('163','381','Verdadero','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('164','381','Falso','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('181','385','INSERT','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('182','386','NO SE','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('151','383','HTML','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('152','383','SQL','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('153','383','CSS','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('154','383','Python','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('155','382','Excel','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('156','382','Oracle','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('157','382','Word','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('158','382','Photoshop','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('282','481','Falso','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('283','482','Verdadero','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('284','482','Falso','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('301','461','Verdadero','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('302','461','Falso','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('303','461','Verdadero','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('304','461','Falso','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('309','461','Verdadero','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('310','461','Falso','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('321','482','Verdadero','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('322','482','Falso','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('325','463','Verdadero','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('326','463','Falso','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('323','441','Verdadero','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('324','441','Falso','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('305','481','Verdadero','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('306','481','Falso','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('307','481','Verdadero','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('308','481','Falso','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('341','501','funciona','S');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('342','501','123456','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('343','501','qwertyu54','N');
Insert into ROOT2.RESPUESTA (ID_RESPUESTA,ID_PREGUNTA,TEXTO,ES_CORRECTA) values ('344','501','234567','N');
REM INSERTING into ROOT2.RESPUESTA_ESTUDIANTE
SET DEFINE OFF;
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('126','48','481','281');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('127','48','482','283');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('128','48','461','241');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('129','48','463','261');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('124','46','461','241');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('125','46','463','261');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('130','47','388','143');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('131','47','361','165');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('132','47','381','163');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('133','47','382','155');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('134','47','383','151');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('141','60','501','341');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('142','60','463','262');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('143','61','501','341');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('144','61','463','262');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('135','53','441','324');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('136','53','461','242');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('137','54','481','281');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('138','54','482','284');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('139','55','501','341');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('140','55','463','262');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('145','62','501','342');
Insert into ROOT2.RESPUESTA_ESTUDIANTE (ID_RESPUESTA_ESTUDIANTE,ID_PRESENTACION,ID_PREGUNTA,ID_RESPUESTA) values ('146','62','463','262');
REM INSERTING into ROOT2.TEMA
SET DEFINE OFF;
Insert into ROOT2.TEMA (ID_TEMA,NOMBRE,ID_UNIDAD) values ('10','Miner?a de Datos',null);
Insert into ROOT2.TEMA (ID_TEMA,NOMBRE,ID_UNIDAD) values ('1','Miner?a de Datos',null);
Insert into ROOT2.TEMA (ID_TEMA,NOMBRE,ID_UNIDAD) values ('2','Ciberseguridad',null);
Insert into ROOT2.TEMA (ID_TEMA,NOMBRE,ID_UNIDAD) values ('3','Bases de Datos',null);
Insert into ROOT2.TEMA (ID_TEMA,NOMBRE,ID_UNIDAD) values ('100','Variables y Tipos de Datos','1');
Insert into ROOT2.TEMA (ID_TEMA,NOMBRE,ID_UNIDAD) values ('101','Condicionales','1');
REM INSERTING into ROOT2.UNIDAD
SET DEFINE OFF;
Insert into ROOT2.UNIDAD (ID_UNIDAD,ID_PLAN,NOMBRE,DESCRIPCION,ORDEN) values ('1','1','Unidad 1','Introducción a la programación','1');
REM INSERTING into ROOT2.USUARIO
SET DEFINE OFF;
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('1','?gata Almaz?n Chico','docenteelagata@edusoft.com','1234','Docente');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('2','Godofredo Carballo M?ndez','godofredoestudiante@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('3','Salud Arana Boix','saludestudiante@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('4','Carolina Su?rez Bou','carolinaestudiante@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('5','To?o Ruano Cantero','to?oestudiante@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('1001','Valentina Ruiz','valentina.b@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('1002','Andr?s L?pez','andres.b@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('1003','Daniela Mart?nez','daniela.b@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('1004','Felipe Navarro','felipe.b@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('1005','Camila Salazar','camila.c@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('1006','Esteban Garc?a','esteban.c@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('1007','Isabella Torres','isabella.c@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('1008','Mateo Rinc?n','mateo.c@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('1009','Laura Estrada','laura.d@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('1010','Juli?n P?rez','julian.d@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('1011','Natalia Mora','natalia.d@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('1012','David Romero','david.d@correo.com','1234','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('6','Jorge Ivan Triviño','docentetrivinnio@edusoft.com','1234','Docente');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('2001','Juan Pérez','juan@example.com','1234','Docente');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('2002','Ana Gómez','ana@example.com','abcd','Estudiante');
Insert into ROOT2.USUARIO (ID_USUARIO,NOMBRE,CORREO,CONTRASENA,TIPO_USUARIO) values ('2003','Luis Torres','luis@example.com','pwd123','Estudiante');
--------------------------------------------------------
--  DDL for Index PK_CORREO
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_CORREO" ON "ROOT2"."USUARIO" ("CORREO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_HORARIO
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_HORARIO" ON "ROOT2"."HORARIO" ("ID_HORARIO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_PREGUNTA
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_PREGUNTA" ON "ROOT2"."PREGUNTA" ("ID_PREGUNTA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_PRESENTACION_EXAMEN
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_PRESENTACION_EXAMEN" ON "ROOT2"."PRESENTACION_EXAMEN" ("ID_PRESENTACION") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_ESTADISTICAS_TEMA
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_ESTADISTICAS_TEMA" ON "ROOT2"."ESTADISTICAS_TEMA" ("ID_TEMA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_ESTADISTICAS_ESTUDIANTE
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_ESTADISTICAS_ESTUDIANTE" ON "ROOT2"."ESTADISTICAS_ESTUDIANTE" ("ID_ESTUDIANTE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_ESTUDIANTE_GRUPO
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_ESTUDIANTE_GRUPO" ON "ROOT2"."ESTUDIANTE_GRUPO" ("ID_ESTUDIANTE", "ID_GRUPO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_EXAMEN_PREGUNTA
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_EXAMEN_PREGUNTA" ON "ROOT2"."EXAMEN_PREGUNTA" ("ID_EXAMEN", "ID_PREGUNTA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_GRUPO
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_GRUPO" ON "ROOT2"."GRUPO" ("ID_GRUPO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_DOCENTE_GRUPO
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_DOCENTE_GRUPO" ON "ROOT2"."DOCENTE_GRUPO" ("ID_DOCENTE", "ID_GRUPO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_ESTUDIANTE
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_ESTUDIANTE" ON "ROOT2"."ESTUDIANTE" ("ID_ESTUDIANTE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_ESTADISTICAS_PREGUNTA
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_ESTADISTICAS_PREGUNTA" ON "ROOT2"."ESTADISTICAS_PREGUNTA" ("ID_PREGUNTA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_EXAMEN
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_EXAMEN" ON "ROOT2"."EXAMEN" ("ID_EXAMEN") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_USUARIO
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_USUARIO" ON "ROOT2"."USUARIO" ("ID_USUARIO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_RESPUESTA
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_RESPUESTA" ON "ROOT2"."RESPUESTA" ("ID_RESPUESTA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_ESTADISTICAS_EXAMEN
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_ESTADISTICAS_EXAMEN" ON "ROOT2"."ESTADISTICAS_EXAMEN" ("ID_ESTADISTICA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_RESPUESTA_ESTUDIANTE
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_RESPUESTA_ESTUDIANTE" ON "ROOT2"."RESPUESTA_ESTUDIANTE" ("ID_RESPUESTA_ESTUDIANTE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_DOCENTE
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_DOCENTE" ON "ROOT2"."DOCENTE" ("ID_DOCENTE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_ESTADISTICAS_GRUPO
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_ESTADISTICAS_GRUPO" ON "ROOT2"."ESTADISTICAS_GRUPO" ("ID_GRUPO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_TEMA
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_TEMA" ON "ROOT2"."TEMA" ("ID_TEMA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_ESTUDIO
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_ESTUDIO" ON "ROOT2"."PLAN_ESTUDIO" ("ID_PLAN") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Index PK_UNIDAD
--------------------------------------------------------

  CREATE UNIQUE INDEX "ROOT2"."PK_UNIDAD" ON "ROOT2"."UNIDAD" ("ID_UNIDAD") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES" ;
--------------------------------------------------------
--  DDL for Trigger TRG_BI_RESPUESTA_ESTUDIANTE
--------------------------------------------------------

  CREATE OR REPLACE NONEDITIONABLE TRIGGER "ROOT2"."TRG_BI_RESPUESTA_ESTUDIANTE" 
BEFORE INSERT ON RESPUESTA_ESTUDIANTE
FOR EACH ROW
BEGIN
    IF :NEW.ID_RESPUESTA_ESTUDIANTE IS NULL THEN
        :NEW.ID_RESPUESTA_ESTUDIANTE := SEQ_RESPUESTA_ESTUDIANTE.NEXTVAL;
    END IF;
END;


/
ALTER TRIGGER "ROOT2"."TRG_BI_RESPUESTA_ESTUDIANTE" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_CALIFICAR_AL_FINALIZAR
--------------------------------------------------------

  CREATE OR REPLACE NONEDITIONABLE TRIGGER "ROOT2"."TRG_CALIFICAR_AL_FINALIZAR" 
AFTER INSERT ON RESPUESTA_ESTUDIANTE
FOR EACH ROW
DECLARE
    v_id_examen EXAMEN.ID_EXAMEN%TYPE;
    v_total_preguntas NUMBER;
    v_total_respondidas NUMBER;
    v_estado VARCHAR2(20);
BEGIN
    BEGIN
        -- Obtener el examen asociado a la presentación
        SELECT ID_EXAMEN INTO v_id_examen
        FROM PRESENTACION_EXAMEN
        WHERE ID_PRESENTACION = :NEW.ID_PRESENTACION;
        
        -- Contar cuántas preguntas tiene el examen
        SELECT COUNT(*) INTO v_total_preguntas
        FROM EXAMEN_PREGUNTA
        WHERE ID_EXAMEN = v_id_examen;
        
        -- Contar cuántas preguntas ha respondido el estudiante
        SELECT COUNT(DISTINCT ID_PREGUNTA) INTO v_total_respondidas
        FROM RESPUESTA_ESTUDIANTE
        WHERE ID_PRESENTACION = :NEW.ID_PRESENTACION;
        
        -- Si ya respondió todas, calificamos
        IF v_total_respondidas = v_total_preguntas THEN
            -- CORRECCIÓN: Llamar al procedimiento dentro del package
            PKG_PRESENTACION_EXAMEN.CALIFICAR_EXAMEN_AUTOMATICO(:NEW.ID_PRESENTACION, v_estado);
        END IF;
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            NULL; -- Silenciar la excepción si no se encuentra la presentación aún
        WHEN OTHERS THEN
            NULL; -- (opcional) evita que cualquier otro error detenga la inserción
    END;
END;
/
ALTER TRIGGER "ROOT2"."TRG_CALIFICAR_AL_FINALIZAR" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_PREGUNTA_ID
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ROOT2"."TRG_PREGUNTA_ID" 
BEFORE INSERT ON PREGUNTA
FOR EACH ROW
BEGIN
    SELECT SEQ_ID_PREGUNTA.NEXTVAL INTO :NEW.ID_PREGUNTA FROM DUAL;
END;
/
ALTER TRIGGER "ROOT2"."TRG_PREGUNTA_ID" ENABLE;
--------------------------------------------------------
--  DDL for Procedure AGREGAR_OPCIONES_RESPUESTA
--------------------------------------------------------
set define off;

  CREATE OR REPLACE NONEDITIONABLE PROCEDURE "ROOT2"."AGREGAR_OPCIONES_RESPUESTA" (
  p_id_pregunta IN NUMBER,
  p_opciones    IN SYS.ODCIVARCHAR2LIST
) IS
  v_id_respuesta NUMBER;
BEGIN
  FOR i IN 1 .. p_opciones.COUNT LOOP
    SELECT SEQ_RESPUESTA.NEXTVAL INTO v_id_respuesta FROM DUAL;

    INSERT INTO RESPUESTA (
      ID_RESPUESTA,
      ID_PREGUNTA,
      TEXTO,
      ES_CORRECTA
    ) VALUES (
      v_id_respuesta,
      p_id_pregunta,
      p_opciones(i),
      'N'
    );
  END LOOP;
END;


/
--------------------------------------------------------
--  DDL for Procedure GENERAR_ESTADISTICAS_ESTUDIANTE
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "ROOT2"."GENERAR_ESTADISTICAS_ESTUDIANTE" (
    p_id_estudiante IN NUMBER
) AS
    v_total_examenes NUMBER := 0;
    v_correctas NUMBER := 0;
    v_incorrectas NUMBER := 0;
    v_promedio NUMBER := 0;
    v_maxima NUMBER := 0;
    v_minima NUMBER := 0;
BEGIN
    -- Obtener estadísticas desde la vista
    SELECT 
        COUNT(DISTINCT pres.id_presentacion),
        SUM(CASE WHEN r.es_correcta = 'S' THEN 1 ELSE 0 END),
        SUM(CASE WHEN r.es_correcta = 'N' THEN 1 ELSE 0 END),
        NVL(AVG(pres.calificacion), 0),
        NVL(MAX(pres.calificacion), 0),
        NVL(MIN(pres.calificacion), 0)
    INTO v_total_examenes, v_correctas, v_incorrectas, v_promedio, v_maxima, v_minima
    FROM PRESENTACION_EXAMEN pres
    JOIN RESPUESTA_ESTUDIANTE res_est ON res_est.id_presentacion = pres.id_presentacion
    JOIN RESPUESTA r ON r.id_respuesta = res_est.id_respuesta
    WHERE pres.id_estudiante = p_id_estudiante;

    -- Mostrar en consola
    DBMS_OUTPUT.PUT_LINE('Total exámenes: ' || v_total_examenes);
    DBMS_OUTPUT.PUT_LINE('Correctas: ' || v_correctas);
    DBMS_OUTPUT.PUT_LINE('Incorrectas: ' || v_incorrectas);
    DBMS_OUTPUT.PUT_LINE('Promedio: ' || ROUND(v_promedio, 2));
    DBMS_OUTPUT.PUT_LINE('Máxima: ' || v_maxima);
    DBMS_OUTPUT.PUT_LINE('Mínima: ' || v_minima);

    -- Guardar en tabla
    MERGE INTO ESTADISTICAS_ESTUDIANTE e
    USING (SELECT p_id_estudiante AS id_estudiante FROM dual) src
    ON (e.id_estudiante = src.id_estudiante)
    WHEN MATCHED THEN
        UPDATE SET 
            total_examenes_presentados = v_total_examenes,
            preguntas_correctas = v_correctas,
            preguntas_incorrectas = v_incorrectas,
            promedio_nota = ROUND(v_promedio, 2),
            max_nota = v_maxima,
            min_nota = v_minima
    WHEN NOT MATCHED THEN
        INSERT (id_estudiante, total_examenes_presentados, preguntas_correctas, preguntas_incorrectas, promedio_nota, max_nota, min_nota)
        VALUES (p_id_estudiante, v_total_examenes, v_correctas, v_incorrectas, ROUND(v_promedio, 2), v_maxima, v_minima);

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
        RAISE;
END;

/
--------------------------------------------------------
--  DDL for Procedure GENERAR_ESTADISTICAS_EXAMEN
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "ROOT2"."GENERAR_ESTADISTICAS_EXAMEN" (
    p_id_examen IN NUMBER
) AS
    v_total_presentaciones NUMBER := 0;
    v_promedio NUMBER := 0;
    v_maxima NUMBER := 0;
    v_minima NUMBER := 0;
BEGIN
    SELECT 
        COUNT(*), 
        NVL(AVG(calificacion), 0), 
        NVL(MAX(calificacion), 0), 
        NVL(MIN(calificacion), 0)
    INTO v_total_presentaciones, v_promedio, v_maxima, v_minima
    FROM PRESENTACION_EXAMEN
    WHERE id_examen = p_id_examen;

    DBMS_OUTPUT.PUT_LINE('Total presentaciones: ' || v_total_presentaciones);
    DBMS_OUTPUT.PUT_LINE('Promedio: ' || ROUND(v_promedio, 2));
    DBMS_OUTPUT.PUT_LINE('Máxima: ' || v_maxima);
    DBMS_OUTPUT.PUT_LINE('Mínima: ' || v_minima);

    -- Guardar en tabla
    MERGE INTO ESTADISTICAS_EXAMEN e
    USING (SELECT p_id_examen AS id_examen FROM dual) src
    ON (e.id_examen = src.id_examen)
    WHEN MATCHED THEN
        UPDATE SET 
            total_presentados = v_total_presentaciones,
            promedio_nota = ROUND(v_promedio, 2),
            max_nota = v_maxima,
            min_nota = v_minima
    WHEN NOT MATCHED THEN
        INSERT (id_estadistica, id_examen, total_presentados, promedio_nota, max_nota, min_nota)
        VALUES (SEQ_ID_PREGUNTA.NEXTVAL, p_id_examen, v_total_presentaciones, ROUND(v_promedio, 2), v_maxima, v_minima);

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
        RAISE;
END;

/
--------------------------------------------------------
--  DDL for Procedure GENERAR_ESTADISTICAS_GRUPO
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "ROOT2"."GENERAR_ESTADISTICAS_GRUPO" (
    p_id_grupo IN NUMBER
) AS
    v_total_examenes NUMBER := 0;
    v_promedio NUMBER := 0;
    v_maxima NUMBER := 0;
    v_minima NUMBER := 0;
BEGIN
    SELECT COUNT(DISTINCT pres.id_presentacion),
           NVL(AVG(pres.calificacion), 0),
           NVL(MAX(pres.calificacion), 0),
           NVL(MIN(pres.calificacion), 0)
    INTO v_total_examenes, v_promedio, v_maxima, v_minima
    FROM GRUPO g
    JOIN ESTUDIANTE_GRUPO eg ON eg.id_grupo = g.id_grupo
    JOIN PRESENTACION_EXAMEN pres ON pres.id_estudiante = eg.id_estudiante
    WHERE g.id_grupo = p_id_grupo;

    DBMS_OUTPUT.PUT_LINE('Grupo ID: ' || p_id_grupo);
    DBMS_OUTPUT.PUT_LINE('Total exámenes: ' || v_total_examenes);
    DBMS_OUTPUT.PUT_LINE('Promedio: ' || ROUND(v_promedio, 2));
    DBMS_OUTPUT.PUT_LINE('Máxima: ' || v_maxima);
    DBMS_OUTPUT.PUT_LINE('Mínima: ' || v_minima);

    MERGE INTO ESTADISTICAS_GRUPO e
    USING (SELECT p_id_grupo AS id_grupo FROM dual) src
    ON (e.id_grupo = src.id_grupo)
    WHEN MATCHED THEN
        UPDATE SET 
            total_examenes_presentados = v_total_examenes,
            promedio_general = ROUND(v_promedio, 2),
            max_nota = v_maxima,
            min_nota = v_minima
    WHEN NOT MATCHED THEN
        INSERT (id_grupo, total_examenes_presentados, promedio_general, max_nota, min_nota)
        VALUES (p_id_grupo, v_total_examenes, ROUND(v_promedio, 2), v_maxima, v_minima);

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
        RAISE;
END;

/
--------------------------------------------------------
--  DDL for Procedure GENERAR_ESTADISTICAS_PREGUNTA
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "ROOT2"."GENERAR_ESTADISTICAS_PREGUNTA" (
    p_id_pregunta IN NUMBER
) AS
    v_total_respuestas NUMBER := 0;
    v_correctas NUMBER := 0;
    v_incorrectas NUMBER := 0;
    v_porcentaje_correctas NUMBER := 0;
BEGIN
    -- Obtener estadísticas de la pregunta
    SELECT NVL(COUNT(*), 0), 
           NVL(SUM(CASE WHEN r.es_correcta = 'S' THEN 1 ELSE 0 END), 0), 
           NVL(SUM(CASE WHEN r.es_correcta = 'N' THEN 1 ELSE 0 END), 0)
    INTO v_total_respuestas, v_correctas, v_incorrectas
    FROM RESPUESTA_ESTUDIANTE re
    JOIN RESPUESTA r ON re.id_respuesta = r.id_respuesta
    WHERE re.id_pregunta = p_id_pregunta;

    -- Calcular porcentaje de aciertos
    IF v_total_respuestas > 0 THEN
        v_porcentaje_correctas := ROUND((v_correctas / v_total_respuestas) * 100, 2);
    ELSE
        v_porcentaje_correctas := 0;
    END IF;

    -- Mostrar en consola
    DBMS_OUTPUT.PUT_LINE('Total respuestas: ' || v_total_respuestas);
    DBMS_OUTPUT.PUT_LINE('Respuestas correctas: ' || v_correctas);
    DBMS_OUTPUT.PUT_LINE('Respuestas incorrectas: ' || v_incorrectas);
    DBMS_OUTPUT.PUT_LINE('Porcentaje de aciertos: ' || v_porcentaje_correctas || '%');

    -- Guardar en tabla de estadísticas
    MERGE INTO ESTADISTICAS_PREGUNTA ep
    USING (SELECT p_id_pregunta AS id_pregunta FROM dual) src
    ON (ep.id_pregunta = src.id_pregunta)
    WHEN MATCHED THEN
        UPDATE SET 
            total_respuestas = v_total_respuestas,
            correctas = v_correctas,
            incorrectas = v_incorrectas,
            porcentaje_correctas = v_porcentaje_correctas
    WHEN NOT MATCHED THEN
        INSERT (id_pregunta, total_respuestas, correctas, incorrectas, porcentaje_correctas)
        VALUES (p_id_pregunta, v_total_respuestas, v_correctas, v_incorrectas, v_porcentaje_correctas);

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
        RAISE;
END;

/
--------------------------------------------------------
--  DDL for Procedure GENERAR_ESTADISTICAS_TEMA
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "ROOT2"."GENERAR_ESTADISTICAS_TEMA" (
    p_id_tema IN NUMBER
) AS
    v_total_respuestas NUMBER := 0;
    v_correctas NUMBER := 0;
    v_incorrectas NUMBER := 0;
    v_promedio_nota NUMBER := 0;
    v_max_nota NUMBER := 0;
    v_min_nota NUMBER := 0;
BEGIN
    SELECT COUNT(re.id_respuesta_estudiante),
           SUM(CASE WHEN r.es_correcta = 'S' THEN 1 ELSE 0 END),
           SUM(CASE WHEN r.es_correcta = 'N' THEN 1 ELSE 0 END),
           NVL(AVG(pres.calificacion), 0),
           NVL(MAX(pres.calificacion), 0),
           NVL(MIN(pres.calificacion), 0)
    INTO v_total_respuestas, v_correctas, v_incorrectas,
         v_promedio_nota, v_max_nota, v_min_nota
    FROM TEMA t
    JOIN PREGUNTA p ON p.id_tema = t.id_tema
    JOIN RESPUESTA r ON r.id_pregunta = p.id_pregunta
    JOIN RESPUESTA_ESTUDIANTE re ON re.id_respuesta = r.id_respuesta
    JOIN PRESENTACION_EXAMEN pres ON pres.id_presentacion = re.id_presentacion
    WHERE t.id_tema = p_id_tema;

    DBMS_OUTPUT.PUT_LINE('Tema ID: ' || p_id_tema);
    DBMS_OUTPUT.PUT_LINE('Total respuestas: ' || v_total_respuestas);
    DBMS_OUTPUT.PUT_LINE('Correctas: ' || v_correctas);
    DBMS_OUTPUT.PUT_LINE('Incorrectas: ' || v_incorrectas);
    DBMS_OUTPUT.PUT_LINE('Promedio: ' || ROUND(v_promedio_nota, 2));
    DBMS_OUTPUT.PUT_LINE('Máxima: ' || v_max_nota);
    DBMS_OUTPUT.PUT_LINE('Mínima: ' || v_min_nota);

    MERGE INTO ESTADISTICAS_TEMA e
    USING (SELECT p_id_tema AS id_tema FROM dual) src
    ON (e.id_tema = src.id_tema)
    WHEN MATCHED THEN
        UPDATE SET 
            total_preguntas = v_total_respuestas,
            total_correctas = v_correctas,
            total_incorrectas = v_incorrectas,
            promedio_nota = ROUND(v_promedio_nota, 2),
            max_nota = v_max_nota,
            min_nota = v_min_nota
    WHEN NOT MATCHED THEN
        INSERT (id_tema, total_preguntas, total_correctas, total_incorrectas, promedio_nota, max_nota, min_nota)
        VALUES (p_id_tema, v_total_respuestas, v_correctas, v_incorrectas, ROUND(v_promedio_nota, 2), v_max_nota, v_min_nota);

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
        RAISE;
END;

/
--------------------------------------------------------
--  DDL for Procedure LOGIN_USUARIO
--------------------------------------------------------
set define off;

  CREATE OR REPLACE NONEDITIONABLE PROCEDURE "ROOT2"."LOGIN_USUARIO" (
    p_correo        IN  VARCHAR2,
    p_contrasena    IN  VARCHAR2,
    p_id_usuario    OUT NUMBER,
    p_nombre        OUT VARCHAR2,
    p_tipo_usuario  OUT VARCHAR2,
    p_estado        OUT VARCHAR2
)
IS
BEGIN
SELECT ID_USUARIO, NOMBRE, TIPO_USUARIO
INTO p_id_usuario, p_nombre, p_tipo_usuario
FROM USUARIO
WHERE CORREO = p_correo
  AND CONTRASENA = p_contrasena
  AND LOWER(TIPO_USUARIO) IN ('estudiante', 'docente');

p_estado := 'OK';
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        p_estado := 'NO_ENCONTRADO';
        p_id_usuario := NULL;
        p_nombre := NULL;
        p_tipo_usuario := NULL;
WHEN OTHERS THEN
        p_estado := 'ERROR';
        p_id_usuario := NULL;
        p_nombre := NULL;
        p_tipo_usuario := NULL;
END;


/
--------------------------------------------------------
--  DDL for Procedure OBTENER_ESTUDIANTE_COMPLETO
--------------------------------------------------------
set define off;

  CREATE OR REPLACE NONEDITIONABLE PROCEDURE "ROOT2"."OBTENER_ESTUDIANTE_COMPLETO" (
    p_id_usuario      IN  NUMBER,
    p_nombre          OUT VARCHAR2,
    p_correo          OUT VARCHAR2,
    p_id_grupo        OUT NUMBER,
    p_nombre_grupo    OUT VARCHAR2,
    p_estado          OUT VARCHAR2
) AS
BEGIN
    SELECT u.nombre, u.correo, g.id_grupo, g.nombre
    INTO p_nombre, p_correo, p_id_grupo, p_nombre_grupo
    FROM USUARIO u
    JOIN ESTUDIANTE e ON u.id_usuario = e.id_estudiante
    LEFT JOIN ESTUDIANTE_GRUPO eg ON e.id_estudiante = eg.id_estudiante
    LEFT JOIN GRUPO g ON eg.id_grupo = g.id_grupo
    WHERE u.id_usuario = p_id_usuario;

    p_estado := 'OK';

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        p_estado := 'NO_ENCONTRADO';
        p_nombre := NULL;
        p_correo := NULL;
        p_id_grupo := NULL;
        p_nombre_grupo := NULL;
    WHEN OTHERS THEN
        p_estado := 'ERROR';
        p_nombre := NULL;
        p_correo := NULL;
        p_id_grupo := NULL;
        p_nombre_grupo := NULL;
END;


/
--------------------------------------------------------
--  DDL for Procedure OBTENER_TEMAS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE NONEDITIONABLE PROCEDURE "ROOT2"."OBTENER_TEMAS" (p_temas OUT TEMA_TABLA) IS
BEGIN
    SELECT TEMA_OBJ(ID_TEMA, NOMBRE)
    BULK COLLECT INTO p_temas
    FROM TEMA
    ORDER BY NOMBRE ASC;
END;

/
--------------------------------------------------------
--  DDL for Procedure REGISTRAR_PRESENTACION
--------------------------------------------------------
set define off;

  CREATE OR REPLACE NONEDITIONABLE PROCEDURE "ROOT2"."REGISTRAR_PRESENTACION" (
    p_id_examen      IN PRESENTACION_EXAMEN.ID_EXAMEN%TYPE,
    p_id_estudiante  IN PRESENTACION_EXAMEN.ID_ESTUDIANTE%TYPE,
    p_id_presentacion OUT PRESENTACION_EXAMEN.ID_PRESENTACION%TYPE
)
AS
    v_intentos        NUMBER := 0;
    v_max_intentos    NUMBER := 1;
BEGIN
    -- Verificar cu?ntos intentos ya tiene el estudiante para este examen
    SELECT COUNT(*) INTO v_intentos
    FROM PRESENTACION_EXAMEN
    WHERE ID_EXAMEN = p_id_examen AND ID_ESTUDIANTE = p_id_estudiante;

    -- Obtener la cantidad m?xima de intentos permitidos para el examen
    SELECT INTENTOS_PERMITIDOS INTO v_max_intentos
    FROM EXAMEN
    WHERE ID_EXAMEN = p_id_examen;

    IF v_intentos >= v_max_intentos THEN
        RAISE_APPLICATION_ERROR(-20005, 'Ya alcanz? el n?mero m?ximo de intentos permitidos para este examen.');
    END IF;

    -- Insertar nuevo intento de presentaci?n
    INSERT INTO PRESENTACION_EXAMEN (
        ID_PRESENTACION,
        ID_EXAMEN,
        ID_ESTUDIANTE,
        FECHA_PRESENTACION
    ) VALUES (
        SEQ_PRESENTACION_EXAMEN.NEXTVAL,
        p_id_examen,
        p_id_estudiante,
        SYSDATE
    ) RETURNING ID_PRESENTACION INTO p_id_presentacion;

    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        RAISE;
END REGISTRAR_PRESENTACION;


/
--------------------------------------------------------
--  DDL for Procedure REGISTRAR_RESPUESTA
--------------------------------------------------------
set define off;

  CREATE OR REPLACE NONEDITIONABLE PROCEDURE "ROOT2"."REGISTRAR_RESPUESTA" (
    p_id_presentacion   IN PRESENTACION_EXAMEN.ID_PRESENTACION%TYPE,
    p_id_pregunta       IN PREGUNTA.ID_PREGUNTA%TYPE,
    p_id_opcion         IN RESPUESTA.ID_RESPUESTA%TYPE
) AS
    v_fecha_fin DATE;
BEGIN
    -- Obtener la fecha l?mite de la presentaci?n
    SELECT FECHA_HORA_FIN
    INTO v_fecha_fin
    FROM PRESENTACION_EXAMEN
    WHERE ID_PRESENTACION = p_id_presentacion;

    -- Validar tiempo
    IF SYSDATE > v_fecha_fin THEN
        RAISE_APPLICATION_ERROR(-20003, 'El tiempo para responder el examen ha finalizado.');
    END IF;

    -- Insertar la respuesta con ID generado
    INSERT INTO RESPUESTA_ESTUDIANTE (
        ID_RESPUESTA_ESTUDIANTE,
        ID_PRESENTACION,
        ID_PREGUNTA,
        ID_RESPUESTA
    )
    VALUES (
        SEQ_RESPUESTA_ESTUDIANTE.NEXTVAL,
        p_id_presentacion,
        p_id_pregunta,
        p_id_opcion
    );

    COMMIT;
END;


/
--------------------------------------------------------
--  DDL for Package PKG_DOCENTE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ROOT2"."PKG_DOCENTE" AS

    PROCEDURE OBTENER_DOCENTE_COMPLETO (
        p_id_usuario      IN  NUMBER,
        p_nombre          OUT VARCHAR2,
        p_correo          OUT VARCHAR2,
        p_asignatura      OUT VARCHAR2,
        p_estado          OUT VARCHAR2
    );
    
    -- Procedimiento para obtener docente por ID
    PROCEDURE OBTENER_DOCENTE_POR_ID(
        p_id_docente IN NUMBER,
        p_cursor OUT SYS_REFCURSOR
    );

END PKG_DOCENTE;

/
--------------------------------------------------------
--  DDL for Package PKG_EXAMEN
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ROOT2"."PKG_EXAMEN" AS
    
    -- Cursor para obtener exámenes por docente
    PROCEDURE OBTENER_EXAMENES_POR_DOCENTE(
        p_id_docente IN NUMBER,
        p_cursor OUT SYS_REFCURSOR
    );

    -- Procedimiento para agregar examen
    PROCEDURE AGREGAR_EXAMEN(
        p_nombre IN VARCHAR2,
        p_descripcion IN VARCHAR2,
        p_fecha_inicio IN DATE,
        p_fecha_fin IN DATE,
        p_tiempo_limite IN NUMBER,
        p_id_docente IN NUMBER,
        p_id_tema IN NUMBER,
        p_id_grupo IN NUMBER,
        p_modo_seleccion IN VARCHAR2,
        p_tiempo_por_pregunta IN NUMBER,
        p_numero_preguntas IN NUMBER,
        p_intentos_permitidos IN NUMBER,
        p_resultado OUT NUMBER
    );

    -- Procedimiento para editar examen
    PROCEDURE EDITAR_EXAMEN(
        p_id_examen IN NUMBER,
        p_nombre IN VARCHAR2,
        p_descripcion IN VARCHAR2,
        p_fecha_inicio IN DATE,
        p_fecha_fin IN DATE,
        p_tiempo_limite IN NUMBER,
        p_id_docente IN NUMBER,
        p_id_tema IN NUMBER,
        p_id_grupo IN NUMBER,
        p_numero_preguntas IN NUMBER,
        p_modo_seleccion IN VARCHAR2,
        p_tiempo_por_pregunta IN NUMBER,
        p_intentos_permitidos IN NUMBER,
        p_resultado OUT NUMBER
    );

    -- Cursor para obtener exámenes por grupo
    PROCEDURE OBTENER_EXAMENES_POR_GRUPO(
        p_id_grupo IN NUMBER,
        p_cursor OUT SYS_REFCURSOR
    );

    -- Procedimiento para eliminar examen
    PROCEDURE ELIMINAR_EXAMEN(
        p_id_examen IN NUMBER,
        p_resultado OUT NUMBER
    );

END PKG_EXAMEN;

/
--------------------------------------------------------
--  DDL for Package PKG_EXAMEN_PREGUNTA
--------------------------------------------------------

  CREATE OR REPLACE NONEDITIONABLE PACKAGE "ROOT2"."PKG_EXAMEN_PREGUNTA" AS

    -- Asignar pregunta a examen con validación de coherencia de tema
    PROCEDURE ASIGNAR_PREGUNTA_A_EXAMEN (
        p_id_examen     IN NUMBER,
        p_id_pregunta   IN NUMBER,
        p_valor_nota    IN NUMBER,
        p_resultado     OUT VARCHAR2
    );

    -- Eliminar pregunta de examen
    PROCEDURE ELIMINAR_PREGUNTA_DE_EXAMEN (
        p_id_examen     IN NUMBER,
        p_id_pregunta   IN NUMBER,
        p_resultado     OUT VARCHAR2
    );

    -- Obtener preguntas de un examen
    PROCEDURE OBTENER_PREGUNTAS_DE_EXAMEN (
        p_id_examen IN NUMBER,
        p_cursor    OUT SYS_REFCURSOR
    );

    -- Validar coherencia de tema entre examen y pregunta
    FUNCTION VALIDAR_COHERENCIA_TEMA_EXAMEN_PREGUNTA (
        p_id_examen   IN NUMBER,
        p_id_pregunta IN NUMBER
    ) RETURN VARCHAR2;

    -- Obtener el total de nota de un examen
    FUNCTION OBTENER_TOTAL_NOTA_EXAMEN (
        p_id_examen IN NUMBER
    ) RETURN NUMBER;

    -- Contar preguntas de un examen
    FUNCTION CONTAR_PREGUNTAS_EXAMEN (
        p_id_examen IN NUMBER
    ) RETURN NUMBER;

    -- Validar si una pregunta ya está asignada a un examen
    FUNCTION PREGUNTA_YA_ASIGNADA (
        p_id_examen   IN NUMBER,
        p_id_pregunta IN NUMBER
    ) RETURN VARCHAR2;

    -- Obtener valor de nota de una pregunta en un examen específico
    FUNCTION OBTENER_VALOR_NOTA_PREGUNTA_EXAMEN (
        p_id_examen   IN NUMBER,
        p_id_pregunta IN NUMBER
    ) RETURN NUMBER;

    -- Actualizar valor de nota de una pregunta en un examen
    PROCEDURE ACTUALIZAR_VALOR_NOTA_PREGUNTA (
        p_id_examen   IN NUMBER,
        p_id_pregunta IN NUMBER,
        p_valor_nota  IN NUMBER,
        p_resultado   OUT VARCHAR2
    );

END PKG_EXAMEN_PREGUNTA;


/
--------------------------------------------------------
--  DDL for Package PKG_GRUPO
--------------------------------------------------------

  CREATE OR REPLACE NONEDITIONABLE PACKAGE "ROOT2"."PKG_GRUPO" AS
    
    -- Tipo para cursor de grupos
    TYPE t_grupo_record IS RECORD (
        id_grupo NUMBER,
        nombre VARCHAR2(200)
    );

    TYPE t_grupos_cursor IS REF CURSOR RETURN t_grupo_record;

    -- FUNCIÓN PARA OBTENER GRUPOS POR DOCENTE
    FUNCTION OBTENER_GRUPOS_POR_DOCENTE (
        p_id_docente IN NUMBER
    ) RETURN t_grupos_cursor;

END PKG_GRUPO;

/
--------------------------------------------------------
--  DDL for Package PKG_PREGUNTA
--------------------------------------------------------

  CREATE OR REPLACE NONEDITIONABLE PACKAGE "ROOT2"."PKG_PREGUNTA" AS
  TYPE T_CURSOR IS REF CURSOR;

  PROCEDURE agregar_pregunta(
    p_texto             IN VARCHAR2,
    p_tipo              IN VARCHAR2,
    p_id_tema           IN NUMBER,
    p_valor_nota        IN NUMBER,
    p_es_publica        IN VARCHAR2,
    p_id_docente        IN NUMBER,
    p_id_pregunta_padre IN NUMBER DEFAULT NULL,
    p_id_generado       OUT NUMBER
  );

  PROCEDURE obtener_preguntas_hijas (
    p_id_padre IN NUMBER,
    p_cursor   OUT SYS_REFCURSOR
  );

  PROCEDURE quitar_vinculo_padre(
    p_id_pregunta IN NUMBER
  );

  PROCEDURE agregar_opcion_respuesta(
    p_id_pregunta IN NUMBER,
    p_texto       IN VARCHAR2,
    p_es_correcta IN VARCHAR2
  );

  PROCEDURE actualizar_pregunta(
    p_id_pregunta       IN NUMBER,
    p_texto             IN VARCHAR2,
    p_tipo              IN VARCHAR2,
    p_id_tema           IN NUMBER,
    p_valor_nota        IN NUMBER,
    p_es_publica        IN VARCHAR2,
    p_id_pregunta_padre IN NUMBER DEFAULT NULL
  );

  PROCEDURE eliminar_pregunta(
    p_id_pregunta IN NUMBER
  );

  PROCEDURE agregar_opciones_respuesta(
    p_id_pregunta IN NUMBER,
    p_opciones    IN OPCION_RESPUESTA_TABLE
  );

  PROCEDURE eliminar_opciones_respuesta(
    p_id_pregunta IN NUMBER
  );

  PROCEDURE obtener_opciones_pregunta(
    p_id_pregunta IN NUMBER,
    p_cursor      OUT SYS_REFCURSOR
  );

  PROCEDURE obtener_preguntas_por_tema_docente(
    p_id_tema    IN NUMBER,
    p_id_docente IN NUMBER,
    p_cursor     OUT SYS_REFCURSOR
  );

  PROCEDURE obtener_preguntas_visibles_docente(
    p_id_docente IN NUMBER,
    p_cursor     OUT SYS_REFCURSOR
  );

  PROCEDURE obtener_preguntas_candidatas_padre(
    p_id_docente IN NUMBER,
    p_cursor     OUT SYS_REFCURSOR
  );

  PROCEDURE obtener_preguntas_con_opciones_por_examen(
    p_id_examen IN NUMBER,
    p_resultado OUT SYS_REFCURSOR
  );
  
  PROCEDURE OBTENER_TEMA_PREGUNTA(
    p_id_pregunta IN NUMBER,
    p_id_tema OUT NUMBER
  );
  
  PROCEDURE VALIDAR_TEMA_HIJA_PADRE(
    p_id_pregunta_padre IN NUMBER,
    p_id_tema_hija IN NUMBER,
    p_resultado OUT VARCHAR2
  );
  
  PROCEDURE obtener_preguntas_por_tema_y_disponibles (
    p_id_tema    IN NUMBER,
    p_id_docente IN NUMBER,
    p_id_examen  IN NUMBER,
    p_cursor     OUT SYS_REFCURSOR
  );
  
  -- Verifica si una pregunta está siendo utilizada en exámenes presentados
  FUNCTION pregunta_esta_en_examen_presentado(
    p_id_pregunta IN NUMBER
  ) RETURN VARCHAR2;

  -- Obtiene información de los exámenes que usan una pregunta específica
  PROCEDURE obtener_examenes_que_usan_pregunta(
    p_id_pregunta IN NUMBER,
    p_cursor      OUT SYS_REFCURSOR
  );  

END PKG_PREGUNTA;

/
--------------------------------------------------------
--  DDL for Package PKG_PRESENTACION_EXAMEN
--------------------------------------------------------

  CREATE OR REPLACE NONEDITIONABLE PACKAGE "ROOT2"."PKG_PRESENTACION_EXAMEN" AS
    PROCEDURE REGISTRAR_RESPUESTA (
        p_id_presentacion   IN PRESENTACION_EXAMEN.ID_PRESENTACION%TYPE,
        p_id_pregunta       IN PREGUNTA.ID_PREGUNTA%TYPE,
        p_id_opcion         IN RESPUESTA.ID_RESPUESTA%TYPE
    );

    PROCEDURE CALIFICAR_EXAMEN_AUTOMATICO (
        p_id_presentacion IN NUMBER,
        p_estado OUT VARCHAR2
    );

    PROCEDURE FINALIZAR_EXAMEN (
        p_id_presentacion IN NUMBER,
        p_estado OUT VARCHAR2
    );

    PROCEDURE CREAR_PRESENTACION_EXAMEN (
        p_id_examen     IN EXAMEN.ID_EXAMEN%TYPE,
        p_id_estudiante IN ESTUDIANTE.ID_ESTUDIANTE%TYPE
    );

    -- NUEVA FUNCIÓN AGREGADA
    FUNCTION OBTENER_CALIFICACION (
        p_id_presentacion IN NUMBER
    ) RETURN NUMBER;

    -- FUNCIÓN PARA CONTAR INTENTOS REALIZADOS
    FUNCTION CONTAR_INTENTOS_REALIZADOS (
        p_id_estudiante IN NUMBER,
        p_id_examen IN NUMBER
    ) RETURN NUMBER;

    -- FUNCIÓN PARA OBTENER INTENTOS PERMITIDOS
    FUNCTION OBTENER_INTENTOS_PERMITIDOS (
        p_id_examen IN NUMBER
    ) RETURN NUMBER;

    -- FUNCIÓN PARA VERIFICAR SI EXAMEN TIENE PRESENTACIONES
    FUNCTION EXAMEN_TIENE_PRESENTACIONES (
        p_id_examen IN NUMBER
    ) RETURN NUMBER;

    -- FUNCIÓN PARA OBTENER ESTADÍSTICAS DE PRESENTACIONES
    FUNCTION OBTENER_ESTADISTICAS_PRESENTACIONES (
        p_id_examen IN NUMBER,
        p_total OUT NUMBER,
        p_finalizados OUT NUMBER,
        p_en_progreso OUT NUMBER
    ) RETURN VARCHAR2;

END PKG_PRESENTACION_EXAMEN;

/
--------------------------------------------------------
--  DDL for Package Body PKG_DOCENTE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ROOT2"."PKG_DOCENTE" AS

    PROCEDURE OBTENER_DOCENTE_COMPLETO (
        p_id_usuario      IN  NUMBER,
        p_nombre          OUT VARCHAR2,
        p_correo          OUT VARCHAR2,
        p_asignatura      OUT VARCHAR2,
        p_estado          OUT VARCHAR2
    ) AS
    BEGIN
        -- Corregir el JOIN: usar el campo correcto de relación
        SELECT u.nombre, u.correo, d.asignatura
        INTO p_nombre, p_correo, p_asignatura
        FROM USUARIO u
        JOIN DOCENTE d ON u.id_usuario = d.id_docente  -- Corrección aquí
        WHERE u.id_usuario = p_id_usuario;
        
        p_estado := 'OK';
        
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            p_estado := 'NO_ENCONTRADO';
            p_nombre := NULL;
            p_correo := NULL;
            p_asignatura := NULL;
        WHEN OTHERS THEN
            p_estado := 'ERROR';
            p_nombre := NULL;
            p_correo := NULL;
            p_asignatura := NULL;
            -- Opcional: Log del error real
            DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
    END;

    -- Implementación: Obtener docente por ID
    PROCEDURE OBTENER_DOCENTE_POR_ID(
        p_id_docente IN NUMBER,
        p_cursor OUT SYS_REFCURSOR
    ) AS
    BEGIN
        OPEN p_cursor FOR
            SELECT d.id_docente,
                   d.asignatura,
                   u.nombre,
                   u.correo,
                   u.contrasena,
                   u.tipo_usuario
            FROM DOCENTE d 
            JOIN USUARIO u ON d.id_docente = u.id_usuario 
            WHERE d.id_docente = p_id_docente;

    EXCEPTION
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('Error al obtener docente por ID: ' || SQLERRM);
            -- En caso de error, devolver cursor vacío
            OPEN p_cursor FOR
                SELECT NULL as id_docente,
                       NULL as id_usuario,
                       NULL as asignatura,
                       NULL as nombre,
                       NULL as correo,
                       NULL as contrasena,
                       NULL as tipo_usuario
                FROM DUAL
                WHERE 1 = 0; -- Esta condición nunca será verdadera, por lo que devuelve 0 filas
    END OBTENER_DOCENTE_POR_ID;

END PKG_DOCENTE;

/
--------------------------------------------------------
--  DDL for Package Body PKG_EXAMEN
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ROOT2"."PKG_EXAMEN" AS

    -- Implementación: Obtener exámenes por docente
    PROCEDURE OBTENER_EXAMENES_POR_DOCENTE(
        p_id_docente IN NUMBER,
        p_cursor OUT SYS_REFCURSOR
    ) AS
    BEGIN
        OPEN p_cursor FOR
            SELECT e.id_examen, 
                   e.nombre, 
                   e.descripcion, 
                   e.fecha_inicio, 
                   e.fecha_fin,
                   e.tiempo_limite, 
                   e.id_docente, 
                   e.id_tema, 
                   e.id_grupo, 
                   t.NOMBRE AS nombre_tema, 
                   g.NOMBRE AS nombre_grupo,
                   e.numero_preguntas, 
                   e.modo_seleccion, 
                   e.tiempo_por_pregunta, 
                   e.intentos_permitidos
            FROM EXAMEN e 
            LEFT JOIN TEMA t ON e.id_tema = t.id_tema 
            LEFT JOIN GRUPO g ON e.id_grupo = g.id_grupo 
            WHERE e.id_docente = p_id_docente 
            ORDER BY e.id_examen DESC;
    EXCEPTION
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('Error al obtener exámenes por docente: ' || SQLERRM);
            RAISE;
    END OBTENER_EXAMENES_POR_DOCENTE;

    -- Implementación: Agregar examen
    PROCEDURE AGREGAR_EXAMEN(
        p_nombre IN VARCHAR2,
        p_descripcion IN VARCHAR2,
        p_fecha_inicio IN DATE,
        p_fecha_fin IN DATE,
        p_tiempo_limite IN NUMBER,
        p_id_docente IN NUMBER,
        p_id_tema IN NUMBER,
        p_id_grupo IN NUMBER,
        p_modo_seleccion IN VARCHAR2,
        p_tiempo_por_pregunta IN NUMBER,
        p_numero_preguntas IN NUMBER,
        p_intentos_permitidos IN NUMBER,
        p_resultado OUT NUMBER
    ) AS
    BEGIN
        -- Validaciones básicas
        IF p_nombre IS NULL OR LENGTH(TRIM(p_nombre)) = 0 THEN
            p_resultado := 0;
            RETURN;
        END IF;

        IF p_fecha_inicio > p_fecha_fin THEN
            p_resultado := 0;
            RETURN;
        END IF;

        -- Insertar el examen
        INSERT INTO EXAMEN (
            NOMBRE, DESCRIPCION, FECHA_INICIO, FECHA_FIN, TIEMPO_LIMITE, 
            ID_DOCENTE, ID_TEMA, ID_GRUPO, MODO_SELECCION, TIEMPO_POR_PREGUNTA, 
            NUMERO_PREGUNTAS, INTENTOS_PERMITIDOS
        ) VALUES (
            p_nombre, p_descripcion, p_fecha_inicio, p_fecha_fin, p_tiempo_limite,
            p_id_docente, p_id_tema, p_id_grupo, p_modo_seleccion, p_tiempo_por_pregunta,
            p_numero_preguntas, p_intentos_permitidos
        );

        p_resultado := SQL%ROWCOUNT;
        COMMIT;

    EXCEPTION
        WHEN OTHERS THEN
            ROLLBACK;
            p_resultado := 0;
            DBMS_OUTPUT.PUT_LINE('Error al agregar examen: ' || SQLERRM);
    END AGREGAR_EXAMEN;

    -- Implementación: Editar examen
    PROCEDURE EDITAR_EXAMEN(
        p_id_examen IN NUMBER,
        p_nombre IN VARCHAR2,
        p_descripcion IN VARCHAR2,
        p_fecha_inicio IN DATE,
        p_fecha_fin IN DATE,
        p_tiempo_limite IN NUMBER,
        p_id_docente IN NUMBER,
        p_id_tema IN NUMBER,
        p_id_grupo IN NUMBER,
        p_numero_preguntas IN NUMBER,
        p_modo_seleccion IN VARCHAR2,
        p_tiempo_por_pregunta IN NUMBER,
        p_intentos_permitidos IN NUMBER,
        p_resultado OUT NUMBER
    ) AS
    BEGIN
        -- Validaciones básicas
        IF p_nombre IS NULL OR LENGTH(TRIM(p_nombre)) = 0 THEN
            p_resultado := 0;
            RETURN;
        END IF;

        IF p_fecha_inicio > p_fecha_fin THEN
            p_resultado := 0;
            RETURN;
        END IF;

        -- Actualizar el examen
        UPDATE EXAMEN 
        SET nombre = p_nombre,
            descripcion = p_descripcion,
            fecha_inicio = p_fecha_inicio,
            fecha_fin = p_fecha_fin,
            tiempo_limite = p_tiempo_limite,
            id_docente = p_id_docente,
            id_tema = p_id_tema,
            id_grupo = p_id_grupo,
            numero_preguntas = p_numero_preguntas,
            modo_seleccion = p_modo_seleccion,
            tiempo_por_pregunta = p_tiempo_por_pregunta,
            intentos_permitidos = p_intentos_permitidos
        WHERE id_examen = p_id_examen;

        p_resultado := SQL%ROWCOUNT;
        COMMIT;

    EXCEPTION
        WHEN OTHERS THEN
            ROLLBACK;
            p_resultado := 0;
            DBMS_OUTPUT.PUT_LINE('Error al editar examen: ' || SQLERRM);
    END EDITAR_EXAMEN;

    -- Implementación: Obtener exámenes por grupo
    PROCEDURE OBTENER_EXAMENES_POR_GRUPO(
        p_id_grupo IN NUMBER,
        p_cursor OUT SYS_REFCURSOR
    ) AS
    BEGIN
        OPEN p_cursor FOR
            SELECT id_examen, 
                   nombre, 
                   descripcion, 
                   fecha_inicio, 
                   fecha_fin, 
                   tiempo_limite, 
                   id_docente, 
                   id_tema, 
                   id_grupo 
            FROM EXAMEN 
            WHERE id_grupo = p_id_grupo
            ORDER BY id_examen;
    EXCEPTION
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('Error al obtener exámenes por grupo: ' || SQLERRM);
            RAISE;
    END OBTENER_EXAMENES_POR_GRUPO;

    -- Implementación: Eliminar examen
    PROCEDURE ELIMINAR_EXAMEN(
        p_id_examen IN NUMBER,
        p_resultado OUT NUMBER
    ) AS
    BEGIN
        -- Verificar si el examen existe
        DECLARE
            v_count NUMBER;
        BEGIN
            SELECT COUNT(*) INTO v_count 
            FROM EXAMEN 
            WHERE id_examen = p_id_examen;

            IF v_count = 0 THEN
                p_resultado := 0;
                RETURN;
            END IF;
        END;

        -- Iniciar transacción
        SAVEPOINT sp_eliminar_examen;

        -- Eliminar relaciones en EXAMEN_PREGUNTA
        DELETE FROM EXAMEN_PREGUNTA 
        WHERE id_examen = p_id_examen;

        -- Eliminar el examen
        DELETE FROM EXAMEN 
        WHERE id_examen = p_id_examen;

        p_resultado := SQL%ROWCOUNT;
        COMMIT;

    EXCEPTION
        WHEN OTHERS THEN
            ROLLBACK TO sp_eliminar_examen;
            p_resultado := 0;
            DBMS_OUTPUT.PUT_LINE('Error al eliminar examen: ' || SQLERRM);
    END ELIMINAR_EXAMEN;

END PKG_EXAMEN;

/
--------------------------------------------------------
--  DDL for Package Body PKG_EXAMEN_PREGUNTA
--------------------------------------------------------

  CREATE OR REPLACE NONEDITIONABLE PACKAGE BODY "ROOT2"."PKG_EXAMEN_PREGUNTA" AS

    PROCEDURE ASIGNAR_PREGUNTA_A_EXAMEN (
        p_id_examen     IN NUMBER,
        p_id_pregunta   IN NUMBER,
        p_valor_nota    IN NUMBER,
        p_resultado     OUT VARCHAR2
    ) AS
        v_coherencia VARCHAR2(1);
        v_ya_asignada VARCHAR2(1);
    BEGIN
        -- Validar coherencia de tema
        v_coherencia := VALIDAR_COHERENCIA_TEMA_EXAMEN_PREGUNTA(p_id_examen, p_id_pregunta);
        
        IF v_coherencia = 'N' THEN
            p_resultado := 'ERROR_TEMA_INCOHERENTE';
            RETURN;
        END IF;

        -- Validar si ya está asignada
        v_ya_asignada := PREGUNTA_YA_ASIGNADA(p_id_examen, p_id_pregunta);
        
        IF v_ya_asignada = 'S' THEN
            p_resultado := 'ERROR_PREGUNTA_YA_ASIGNADA';
            RETURN;
        END IF;

        -- Insertar la asignación
        INSERT INTO EXAMEN_PREGUNTA (
            ID_EXAMEN,
            ID_PREGUNTA,
            VALOR_NOTA
        ) VALUES (
            p_id_examen,
            p_id_pregunta,
            p_valor_nota
        );

        COMMIT;
        p_resultado := 'OK';

    EXCEPTION
        WHEN DUP_VAL_ON_INDEX THEN
            p_resultado := 'ERROR_DUPLICADO';
            ROLLBACK;
        WHEN OTHERS THEN
            p_resultado := 'ERROR_GENERAL';
            ROLLBACK;
    END ASIGNAR_PREGUNTA_A_EXAMEN;

    PROCEDURE ELIMINAR_PREGUNTA_DE_EXAMEN (
        p_id_examen     IN NUMBER,
        p_id_pregunta   IN NUMBER,
        p_resultado     OUT VARCHAR2
    ) AS
        v_count NUMBER;
    BEGIN
        -- Verificar que la asignación existe
        SELECT COUNT(*)
        INTO v_count
        FROM EXAMEN_PREGUNTA
        WHERE ID_EXAMEN = p_id_examen AND ID_PREGUNTA = p_id_pregunta;

        IF v_count = 0 THEN
            p_resultado := 'ERROR_NO_ENCONTRADO';
            RETURN;
        END IF;

        -- Eliminar la asignación
        DELETE FROM EXAMEN_PREGUNTA
        WHERE ID_EXAMEN = p_id_examen AND ID_PREGUNTA = p_id_pregunta;

        COMMIT;
        p_resultado := 'OK';

    EXCEPTION
        WHEN OTHERS THEN
            p_resultado := 'ERROR_GENERAL';
            ROLLBACK;
    END ELIMINAR_PREGUNTA_DE_EXAMEN;

    PROCEDURE OBTENER_PREGUNTAS_DE_EXAMEN (
        p_id_examen IN NUMBER,
        p_cursor    OUT SYS_REFCURSOR
    ) AS
    BEGIN
        OPEN p_cursor FOR
        SELECT 
            p.ID_PREGUNTA,
            p.TEXTO,
            p.TIPO,
            p.ID_TEMA,
            t.NOMBRE AS NOMBRE_TEMA,
            ep.VALOR_NOTA,
            p.ES_PUBLICA,
            p.ID_DOCENTE,
            p.ID_PREGUNTA_PADRE
        FROM PREGUNTA p
        JOIN EXAMEN_PREGUNTA ep ON ep.ID_PREGUNTA = p.ID_PREGUNTA
        LEFT JOIN TEMA t ON p.ID_TEMA = t.ID_TEMA
        WHERE ep.ID_EXAMEN = p_id_examen
        ORDER BY p.ID_PREGUNTA;

    EXCEPTION
        WHEN OTHERS THEN
            IF p_cursor%ISOPEN THEN
                CLOSE p_cursor;
            END IF;
            RAISE_APPLICATION_ERROR(-20001, 'Error al obtener preguntas del examen: ' || SQLERRM);
    END OBTENER_PREGUNTAS_DE_EXAMEN;

    FUNCTION VALIDAR_COHERENCIA_TEMA_EXAMEN_PREGUNTA (
        p_id_examen   IN NUMBER,
        p_id_pregunta IN NUMBER
    ) RETURN VARCHAR2 AS
        v_count NUMBER;
    BEGIN
        SELECT COUNT(*)
        INTO v_count
        FROM EXAMEN e
        JOIN PREGUNTA p ON e.ID_TEMA = p.ID_TEMA
        WHERE e.ID_EXAMEN = p_id_examen AND p.ID_PREGUNTA = p_id_pregunta;

        IF v_count > 0 THEN
            RETURN 'S';
        ELSE
            RETURN 'N';
        END IF;

    EXCEPTION
        WHEN OTHERS THEN
            RETURN 'N';
    END VALIDAR_COHERENCIA_TEMA_EXAMEN_PREGUNTA;

    FUNCTION OBTENER_TOTAL_NOTA_EXAMEN (
        p_id_examen IN NUMBER
    ) RETURN NUMBER AS
        v_total NUMBER := 0;
    BEGIN
        SELECT NVL(SUM(VALOR_NOTA), 0)
        INTO v_total
        FROM EXAMEN_PREGUNTA
        WHERE ID_EXAMEN = p_id_examen;

        RETURN v_total;

    EXCEPTION
        WHEN OTHERS THEN
            RETURN 0;
    END OBTENER_TOTAL_NOTA_EXAMEN;

    FUNCTION CONTAR_PREGUNTAS_EXAMEN (
        p_id_examen IN NUMBER
    ) RETURN NUMBER AS
        v_count NUMBER := 0;
    BEGIN
        SELECT COUNT(*)
        INTO v_count
        FROM EXAMEN_PREGUNTA
        WHERE ID_EXAMEN = p_id_examen;

        RETURN v_count;

    EXCEPTION
        WHEN OTHERS THEN
            RETURN 0;
    END CONTAR_PREGUNTAS_EXAMEN;

    FUNCTION PREGUNTA_YA_ASIGNADA (
        p_id_examen   IN NUMBER,
        p_id_pregunta IN NUMBER
    ) RETURN VARCHAR2 AS
        v_count NUMBER;
    BEGIN
        SELECT COUNT(*)
        INTO v_count
        FROM EXAMEN_PREGUNTA
        WHERE ID_EXAMEN = p_id_examen AND ID_PREGUNTA = p_id_pregunta;

        IF v_count > 0 THEN
            RETURN 'S';
        ELSE
            RETURN 'N';
        END IF;

    EXCEPTION
        WHEN OTHERS THEN
            RETURN 'N';
    END PREGUNTA_YA_ASIGNADA;

    FUNCTION OBTENER_VALOR_NOTA_PREGUNTA_EXAMEN (
        p_id_examen   IN NUMBER,
        p_id_pregunta IN NUMBER
    ) RETURN NUMBER AS
        v_valor_nota NUMBER;
    BEGIN
        SELECT VALOR_NOTA
        INTO v_valor_nota
        FROM EXAMEN_PREGUNTA
        WHERE ID_EXAMEN = p_id_examen AND ID_PREGUNTA = p_id_pregunta;

        RETURN v_valor_nota;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            RETURN -1;
        WHEN OTHERS THEN
            RETURN -1;
    END OBTENER_VALOR_NOTA_PREGUNTA_EXAMEN;

    PROCEDURE ACTUALIZAR_VALOR_NOTA_PREGUNTA (
        p_id_examen   IN NUMBER,
        p_id_pregunta IN NUMBER,
        p_valor_nota  IN NUMBER,
        p_resultado   OUT VARCHAR2
    ) AS
        v_count NUMBER;
    BEGIN
        -- Verificar que la asignación existe
        SELECT COUNT(*)
        INTO v_count
        FROM EXAMEN_PREGUNTA
        WHERE ID_EXAMEN = p_id_examen AND ID_PREGUNTA = p_id_pregunta;

        IF v_count = 0 THEN
            p_resultado := 'ERROR_NO_ENCONTRADO';
            RETURN;
        END IF;

        -- Actualizar el valor de la nota
        UPDATE EXAMEN_PREGUNTA
        SET VALOR_NOTA = p_valor_nota
        WHERE ID_EXAMEN = p_id_examen AND ID_PREGUNTA = p_id_pregunta;

        COMMIT;
        p_resultado := 'OK';

    EXCEPTION
        WHEN OTHERS THEN
            p_resultado := 'ERROR_GENERAL';
            ROLLBACK;
    END ACTUALIZAR_VALOR_NOTA_PREGUNTA;

END PKG_EXAMEN_PREGUNTA;

/
--------------------------------------------------------
--  DDL for Package Body PKG_GRUPO
--------------------------------------------------------

  CREATE OR REPLACE NONEDITIONABLE PACKAGE BODY "ROOT2"."PKG_GRUPO" AS

    -- IMPLEMENTACIÓN OBTENER GRUPOS POR DOCENTE
    FUNCTION OBTENER_GRUPOS_POR_DOCENTE (
        p_id_docente IN NUMBER
    ) RETURN t_grupos_cursor
    IS
        v_cursor t_grupos_cursor;
    BEGIN
        OPEN v_cursor FOR
            SELECT g.ID_GRUPO, g.NOMBRE
            FROM GRUPO g
            JOIN DOCENTE_GRUPO dg ON g.ID_GRUPO = dg.ID_GRUPO
            WHERE dg.ID_DOCENTE = p_id_docente
            ORDER BY g.NOMBRE;

        RETURN v_cursor;

    EXCEPTION
        WHEN OTHERS THEN
            IF v_cursor%ISOPEN THEN
                CLOSE v_cursor;
            END IF;
            RAISE;
    END OBTENER_GRUPOS_POR_DOCENTE;

END PKG_GRUPO;

/
--------------------------------------------------------
--  DDL for Package Body PKG_PREGUNTA
--------------------------------------------------------

  CREATE OR REPLACE NONEDITIONABLE PACKAGE BODY "ROOT2"."PKG_PREGUNTA" AS

  PROCEDURE agregar_pregunta (
    p_texto             IN VARCHAR2,
    p_tipo              IN VARCHAR2,
    p_id_tema           IN NUMBER,
    p_valor_nota        IN NUMBER,
    p_es_publica        IN VARCHAR2,
    p_id_docente        IN NUMBER,
    p_id_pregunta_padre IN NUMBER DEFAULT NULL,
    p_id_generado       OUT NUMBER
  ) IS
  BEGIN
    INSERT INTO pregunta (
      id_pregunta, texto, tipo, id_tema, valor_nota,
      es_publica, id_docente, id_pregunta_padre
    )
    VALUES (
      SEQ_PREGUNTA.NEXTVAL, p_texto, p_tipo, p_id_tema,
      p_valor_nota, p_es_publica, p_id_docente, p_id_pregunta_padre
    )
    RETURNING id_pregunta INTO p_id_generado;
  END agregar_pregunta;

  PROCEDURE agregar_opcion_respuesta (
    p_id_pregunta IN NUMBER,
    p_texto       IN VARCHAR2,
    p_es_correcta IN VARCHAR2
  ) IS
  BEGIN
    INSERT INTO respuesta (
      id_respuesta, id_pregunta, texto, es_correcta
    )
    VALUES (
      SEQ_RESPUESTA.NEXTVAL, p_id_pregunta, p_texto, p_es_correcta
    );
  END agregar_opcion_respuesta;

  PROCEDURE actualizar_pregunta (
    p_id_pregunta       IN NUMBER,
    p_texto             IN VARCHAR2,
    p_tipo              IN VARCHAR2,
    p_id_tema           IN NUMBER,
    p_valor_nota        IN NUMBER,
    p_es_publica        IN VARCHAR2,
    p_id_pregunta_padre IN NUMBER DEFAULT NULL
  ) IS
  BEGIN
    UPDATE pregunta
    SET texto = p_texto,
        tipo = p_tipo,
        id_tema = p_id_tema,
        valor_nota = p_valor_nota,
        es_publica = p_es_publica,
        id_pregunta_padre = p_id_pregunta_padre
    WHERE id_pregunta = p_id_pregunta;

    IF SQL%ROWCOUNT = 0 THEN
      RAISE_APPLICATION_ERROR(-20001, 'No se encontró la pregunta con ID: ' || p_id_pregunta);
    END IF;

    COMMIT;
  END actualizar_pregunta;

  PROCEDURE eliminar_pregunta (p_id_pregunta IN NUMBER) IS
  BEGIN
    DELETE FROM respuesta WHERE id_pregunta = p_id_pregunta;
    DELETE FROM examen_pregunta WHERE id_pregunta = p_id_pregunta;
    DELETE FROM pregunta WHERE id_pregunta = p_id_pregunta;
  END eliminar_pregunta;

  PROCEDURE agregar_opciones_respuesta(
    p_id_pregunta IN NUMBER,
    p_opciones    IN OPCION_RESPUESTA_TABLE
  ) IS
  BEGIN
    FOR i IN 1 .. p_opciones.COUNT LOOP
      INSERT INTO respuesta (
        id_respuesta, id_pregunta, texto, es_correcta
      )
      VALUES (
        SEQ_RESPUESTA.NEXTVAL,
        p_id_pregunta,
        p_opciones(i).texto,
        p_opciones(i).es_correcta
      );
    END LOOP;
  END agregar_opciones_respuesta;

  PROCEDURE eliminar_opciones_respuesta(
    p_id_pregunta IN NUMBER
  ) IS
  BEGIN
    DELETE FROM respuesta WHERE id_pregunta = p_id_pregunta;
  END eliminar_opciones_respuesta;

  PROCEDURE obtener_opciones_pregunta (
    p_id_pregunta IN NUMBER,
    p_cursor      OUT SYS_REFCURSOR
  ) IS
  BEGIN
    OPEN p_cursor FOR
    SELECT * FROM respuesta WHERE id_pregunta = p_id_pregunta;
  END obtener_opciones_pregunta;

  PROCEDURE obtener_preguntas_por_tema_docente (
    p_id_tema    IN NUMBER,
    p_id_docente IN NUMBER,
    p_cursor     OUT SYS_REFCURSOR
  ) IS
  BEGIN
    OPEN p_cursor FOR
    SELECT p.ID_PREGUNTA, 
           p.TEXTO, 
           p.TIPO, 
           p.ID_TEMA, 
           t.NOMBRE AS NOMBRE_TEMA, 
           NVL(p.VALOR_NOTA, 0) AS VALOR_NOTA, 
           p.ES_PUBLICA, 
           p.ID_DOCENTE,
           p.ID_PREGUNTA_PADRE --------
    FROM PREGUNTA p 
    LEFT JOIN TEMA t ON p.ID_TEMA = t.ID_TEMA 
    WHERE p.ID_TEMA = p_id_tema 
      AND (p.ES_PUBLICA = 'S' OR p.ID_DOCENTE = p_id_docente)
    ORDER BY p.ID_PREGUNTA DESC;
  END obtener_preguntas_por_tema_docente;

  PROCEDURE obtener_preguntas_visibles_docente (
    p_id_docente IN NUMBER,
    p_cursor     OUT SYS_REFCURSOR
  ) IS
  BEGIN
    OPEN p_cursor FOR
    SELECT p.ID_PREGUNTA, 
           p.TEXTO, 
           p.TIPO, 
           p.ID_TEMA, 
           t.NOMBRE AS NOMBRE_TEMA, 
           NVL(p.VALOR_NOTA, 0) AS VALOR_NOTA, 
           p.ES_PUBLICA, 
           p.ID_DOCENTE,
           p.ID_PREGUNTA_PADRE 
    FROM PREGUNTA p 
    LEFT JOIN TEMA t ON p.ID_TEMA = t.ID_TEMA 
    WHERE p.ES_PUBLICA = 'S' OR p.ID_DOCENTE = p_id_docente
    ORDER BY p.ID_PREGUNTA DESC;
  END obtener_preguntas_visibles_docente;

  PROCEDURE obtener_preguntas_con_opciones_por_examen (
    p_id_examen IN NUMBER,
    p_resultado OUT SYS_REFCURSOR
  ) IS
  BEGIN
    OPEN p_resultado FOR
    SELECT 
      p.ID_PREGUNTA     AS P_ID_PREGUNTA,
      p.TEXTO           AS P_TEXTO,
      p.TIPO            AS P_TIPO,
      p.ID_TEMA         AS P_ID_TEMA,
      p.ID_PREGUNTA_PADRE AS P_ID_PREGUNTA_PADRE,-----
      p.VALOR_NOTA      AS P_VALOR_NOTA,
      r.ID_RESPUESTA    AS R_ID_RESPUESTA,
      r.TEXTO           AS R_TEXTO,
      r.ES_CORRECTA     AS R_ES_CORRECTA
    FROM examen_pregunta ep
    JOIN pregunta p ON ep.id_pregunta = p.id_pregunta
    LEFT JOIN respuesta r ON p.id_pregunta = r.id_pregunta
    WHERE ep.id_examen = p_id_examen
    ORDER BY p.ID_PREGUNTA, r.ID_RESPUESTA;
  END obtener_preguntas_con_opciones_por_examen;

  PROCEDURE obtener_preguntas_hijas (
    p_id_padre IN NUMBER,
    p_cursor   OUT SYS_REFCURSOR
  ) IS
  BEGIN
    OPEN p_cursor FOR
    SELECT * FROM pregunta
    WHERE id_pregunta_padre = p_id_padre;
  END obtener_preguntas_hijas;

  PROCEDURE quitar_vinculo_padre (
    p_id_pregunta IN NUMBER
  ) IS
  BEGIN
    UPDATE pregunta
    SET id_pregunta_padre = NULL
    WHERE id_pregunta = p_id_pregunta;
  END quitar_vinculo_padre;

  PROCEDURE obtener_preguntas_candidatas_padre (
    p_id_docente IN NUMBER,
    p_cursor     OUT SYS_REFCURSOR
  ) IS
  BEGIN
    OPEN p_cursor FOR
    SELECT p.ID_PREGUNTA, 
           p.TEXTO, 
           p.TIPO, 
           p.ID_TEMA, 
           t.NOMBRE AS NOMBRE_TEMA, 
           NVL(p.VALOR_NOTA, 0) AS VALOR_NOTA, 
           p.ES_PUBLICA, 
           p.ID_DOCENTE,
           p.ID_PREGUNTA_PADRE 
    FROM PREGUNTA p 
    LEFT JOIN TEMA t ON p.ID_TEMA = t.ID_TEMA 
    WHERE (p.ES_PUBLICA = 'S' OR p.ID_DOCENTE = p_id_docente)
      AND p.ID_PREGUNTA_PADRE IS NULL  -- Solo preguntas que NO son hijas
    ORDER BY p.ID_PREGUNTA DESC;
  END obtener_preguntas_candidatas_padre;
  
  PROCEDURE OBTENER_TEMA_PREGUNTA(
    p_id_pregunta IN NUMBER,
    p_id_tema OUT NUMBER
  ) IS
  BEGIN
    SELECT ID_TEMA 
    INTO p_id_tema
    FROM PREGUNTA 
    WHERE ID_PREGUNTA = p_id_pregunta;
    
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            p_id_tema := -1;
        WHEN OTHERS THEN
            RAISE_APPLICATION_ERROR(-20001, 'Error al obtener tema de pregunta: ' || SQLERRM);
    END OBTENER_TEMA_PREGUNTA;
    
    PROCEDURE VALIDAR_TEMA_HIJA_PADRE(
        p_id_pregunta_padre IN NUMBER,
        p_id_tema_hija IN NUMBER,
        p_resultado OUT VARCHAR2
    ) IS
        v_tema_padre NUMBER;
  BEGIN
    -- Obtener el tema de la pregunta padre
    SELECT ID_TEMA 
    INTO v_tema_padre
    FROM PREGUNTA 
    WHERE ID_PREGUNTA = p_id_pregunta_padre;
    
    -- Comparar temas
    IF v_tema_padre = p_id_tema_hija THEN
        p_resultado := 'VALIDO';
    ELSE
        p_resultado := 'INVALIDO';
    END IF;
    
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            p_resultado := 'PADRE_NO_ENCONTRADO';
        WHEN OTHERS THEN
            RAISE_APPLICATION_ERROR(-20002, 'Error al validar tema hija-padre: ' || SQLERRM);
    END VALIDAR_TEMA_HIJA_PADRE;

  PROCEDURE obtener_preguntas_por_tema_y_disponibles (
    p_id_tema    IN NUMBER,
    p_id_docente IN NUMBER,
    p_id_examen  IN NUMBER,
    p_cursor     OUT SYS_REFCURSOR
  ) IS
  BEGIN
    OPEN p_cursor FOR
    SELECT p.ID_PREGUNTA, 
           p.TEXTO, 
           p.TIPO, 
           p.ID_TEMA, 
           t.NOMBRE AS NOMBRE_TEMA, 
           NVL(p.VALOR_NOTA, 0) AS VALOR_NOTA, 
           p.ES_PUBLICA, 
           p.ID_DOCENTE,
           p.ID_PREGUNTA_PADRE
    FROM PREGUNTA p
    LEFT JOIN TEMA t ON p.ID_TEMA = t.ID_TEMA
    WHERE p.ID_TEMA = p_id_tema
      AND (p.ES_PUBLICA = 'S' OR p.ID_DOCENTE = p_id_docente)
      AND p.ID_PREGUNTA NOT IN (
        SELECT ID_PREGUNTA
        FROM EXAMEN_PREGUNTA
        WHERE ID_EXAMEN = p_id_examen
      )
    ORDER BY p.ID_PREGUNTA DESC;
  END obtener_preguntas_por_tema_y_disponibles;
  
-- Agregar estas implementaciones al PACKAGE BODY PKG_PREGUNTA (antes del END final)

  FUNCTION pregunta_esta_en_examen_presentado(
    p_id_pregunta IN NUMBER
  ) RETURN VARCHAR2 IS
    v_count NUMBER := 0;
  BEGIN
    SELECT COUNT(*)
    INTO v_count
    FROM EXAMEN_PREGUNTA ep
    JOIN PRESENTACION_EXAMEN pe ON ep.ID_EXAMEN = pe.ID_EXAMEN
    WHERE ep.ID_PREGUNTA = p_id_pregunta 
      AND pe.ESTADO IN ('FINALIZADO', 'EN_PROGRESO');
    
    -- Log para debug (opcional)
    DBMS_OUTPUT.PUT_LINE('>> Pregunta ' || p_id_pregunta || ' está en ' || v_count || ' presentaciones');
    
    IF v_count > 0 THEN
      RETURN 'S';
    ELSE
      RETURN 'N';
    END IF;
    
  EXCEPTION
    WHEN OTHERS THEN
      RAISE_APPLICATION_ERROR(-20003, 'Error al verificar pregunta en examen presentado: ' || SQLERRM);
  END pregunta_esta_en_examen_presentado;

  PROCEDURE obtener_examenes_que_usan_pregunta(
    p_id_pregunta IN NUMBER,
    p_cursor      OUT SYS_REFCURSOR
  ) IS
  BEGIN
    OPEN p_cursor FOR
    SELECT DISTINCT 
      e.ID_EXAMEN,
      e.NOMBRE,
      e.FECHA_INICIO,
      e.FECHA_FIN,
      COUNT(pe.ID_PRESENTACION) AS TOTAL_PRESENTACIONES
    FROM EXAMEN e
    JOIN EXAMEN_PREGUNTA ep ON e.ID_EXAMEN = ep.ID_EXAMEN
    LEFT JOIN PRESENTACION_EXAMEN pe ON e.ID_EXAMEN = pe.ID_EXAMEN
    WHERE ep.ID_PREGUNTA = p_id_pregunta
    GROUP BY e.ID_EXAMEN, e.NOMBRE, e.FECHA_INICIO, e.FECHA_FIN
    ORDER BY e.FECHA_INICIO DESC;
    
  EXCEPTION
    WHEN OTHERS THEN
      RAISE_APPLICATION_ERROR(-20004, 'Error al obtener exámenes que usan pregunta: ' || SQLERRM);
  END obtener_examenes_que_usan_pregunta;  
  
END PKG_PREGUNTA;

/
--------------------------------------------------------
--  DDL for Package Body PKG_PRESENTACION_EXAMEN
--------------------------------------------------------

  CREATE OR REPLACE NONEDITIONABLE PACKAGE BODY "ROOT2"."PKG_PRESENTACION_EXAMEN" AS

    PROCEDURE REGISTRAR_RESPUESTA (
        p_id_presentacion   IN PRESENTACION_EXAMEN.ID_PRESENTACION%TYPE,
        p_id_pregunta       IN PREGUNTA.ID_PREGUNTA%TYPE,
        p_id_opcion         IN RESPUESTA.ID_RESPUESTA%TYPE
    ) AS
        v_fecha_fin DATE;
    BEGIN
        SELECT FECHA_HORA_FIN
        INTO v_fecha_fin
        FROM PRESENTACION_EXAMEN
        WHERE ID_PRESENTACION = p_id_presentacion;

        IF SYSDATE > v_fecha_fin THEN
            RAISE_APPLICATION_ERROR(-20003, 'El tiempo para responder el examen ha finalizado.');
        END IF;

        INSERT INTO RESPUESTA_ESTUDIANTE (
            ID_RESPUESTA_ESTUDIANTE,
            ID_PRESENTACION,
            ID_PREGUNTA,
            ID_RESPUESTA
        )
        VALUES (
            SEQ_RESPUESTA_ESTUDIANTE.NEXTVAL,
            p_id_presentacion,
            p_id_pregunta,
            p_id_opcion
        );

        COMMIT;
    END REGISTRAR_RESPUESTA;

    PROCEDURE CALIFICAR_EXAMEN_AUTOMATICO (
        p_id_presentacion IN NUMBER,
        p_estado OUT VARCHAR2
    )
    IS
        v_id_examen       NUMBER;
        v_total_posible   NUMBER := 0;
        v_total_obtenido  NUMBER := 0;
        v_calificacion    NUMBER(5,2);
    BEGIN
        SELECT ID_EXAMEN
        INTO v_id_examen
        FROM PRESENTACION_EXAMEN
        WHERE ID_PRESENTACION = p_id_presentacion;

        FOR pr IN (
            SELECT ep.ID_PREGUNTA, p.TIPO, ep.VALOR_NOTA
            FROM EXAMEN_PREGUNTA ep
            JOIN PREGUNTA p ON p.ID_PREGUNTA = ep.ID_PREGUNTA
            WHERE ep.ID_EXAMEN = v_id_examen
        ) LOOP

            IF pr.TIPO = 'Compuesta' THEN
                DECLARE
                    v_suma_hijas NUMBER := 0;
                BEGIN
                    SELECT SUM(ep.VALOR_NOTA)
                    INTO v_suma_hijas
                    FROM EXAMEN_PREGUNTA ep
                    JOIN PREGUNTA ph ON ep.ID_PREGUNTA = ph.ID_PREGUNTA
                    WHERE ep.ID_EXAMEN = v_id_examen
                      AND ph.ID_PREGUNTA_PADRE = pr.ID_PREGUNTA;

                    FOR hija IN (
                        SELECT ep.ID_PREGUNTA, ep.VALOR_NOTA
                        FROM EXAMEN_PREGUNTA ep
                        JOIN PREGUNTA ph ON ep.ID_PREGUNTA = ph.ID_PREGUNTA
                        WHERE ep.ID_EXAMEN = v_id_examen
                          AND ph.ID_PREGUNTA_PADRE = pr.ID_PREGUNTA
                    ) LOOP
                        DECLARE
                            v_es_correcta VARCHAR2(1);
                            v_id_resp NUMBER;
                            v_nota_ponderada NUMBER := hija.VALOR_NOTA;
                        BEGIN
                            IF v_suma_hijas > pr.VALOR_NOTA THEN
                                v_nota_ponderada := (hija.VALOR_NOTA / v_suma_hijas) * pr.VALOR_NOTA;
                            END IF;

                            SELECT ID_RESPUESTA INTO v_id_resp
                            FROM RESPUESTA_ESTUDIANTE
                            WHERE ID_PRESENTACION = p_id_presentacion
                              AND ID_PREGUNTA = hija.ID_PREGUNTA;

                            SELECT ES_CORRECTA INTO v_es_correcta
                            FROM RESPUESTA
                            WHERE ID_RESPUESTA = v_id_resp;

                            v_total_posible := v_total_posible + v_nota_ponderada;
                            IF v_es_correcta = 'S' THEN
                                v_total_obtenido := v_total_obtenido + v_nota_ponderada;
                            END IF;

                        EXCEPTION
                            WHEN NO_DATA_FOUND THEN
                                NULL;
                        END;
                    END LOOP;
                END;

            ELSE
                DECLARE
                    v_es_correcta VARCHAR2(1);
                    v_id_resp NUMBER;
                BEGIN
                    v_total_posible := v_total_posible + pr.VALOR_NOTA;

                    SELECT ID_RESPUESTA INTO v_id_resp
                    FROM RESPUESTA_ESTUDIANTE
                    WHERE ID_PRESENTACION = p_id_presentacion
                      AND ID_PREGUNTA = pr.ID_PREGUNTA;

                    SELECT ES_CORRECTA INTO v_es_correcta
                    FROM RESPUESTA
                    WHERE ID_RESPUESTA = v_id_resp;

                    IF v_es_correcta = 'S' THEN
                        v_total_obtenido := v_total_obtenido + pr.VALOR_NOTA;
                    END IF;

                EXCEPTION
                    WHEN NO_DATA_FOUND THEN
                        NULL;
                END;
            END IF;
        END LOOP;

        IF v_total_posible > 0 THEN
            v_calificacion := ROUND((v_total_obtenido * 5) / v_total_posible, 2);
        ELSE
            v_calificacion := 0;
        END IF;

        UPDATE PRESENTACION_EXAMEN
        SET CALIFICACION = v_calificacion,
            ESTADO = 'FINALIZADO'
        WHERE ID_PRESENTACION = p_id_presentacion;

        p_estado := 'OK';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            p_estado := 'NO_ENCONTRADO';
        WHEN OTHERS THEN
            p_estado := 'ERROR';
    END CALIFICAR_EXAMEN_AUTOMATICO;

    PROCEDURE FINALIZAR_EXAMEN (
        p_id_presentacion IN NUMBER,
        p_estado OUT VARCHAR2
    )
    AS
    BEGIN
        UPDATE PRESENTACION_EXAMEN
        SET FECHA_HORA_FIN = SYSDATE
        WHERE ID_PRESENTACION = p_id_presentacion;

        CALIFICAR_EXAMEN_AUTOMATICO(p_id_presentacion, p_estado);
        COMMIT;

    EXCEPTION
        WHEN OTHERS THEN
            p_estado := 'ERROR_FINALIZAR';
            ROLLBACK;
    END FINALIZAR_EXAMEN;

    PROCEDURE CREAR_PRESENTACION_EXAMEN (
        p_id_examen     IN EXAMEN.ID_EXAMEN%TYPE,
        p_id_estudiante IN ESTUDIANTE.ID_ESTUDIANTE%TYPE
    ) AS
        v_id_grupo             EXAMEN.ID_GRUPO%TYPE;
        v_fecha_inicio         EXAMEN.FECHA_INICIO%TYPE;
        v_fecha_fin            EXAMEN.FECHA_FIN%TYPE;
        v_tiempo_limite        EXAMEN.TIEMPO_LIMITE%TYPE;
        v_estudiante_en_grupo  NUMBER;
    BEGIN
        -- Obtener datos del examen
        SELECT ID_GRUPO, FECHA_INICIO, FECHA_FIN, TIEMPO_LIMITE
        INTO v_id_grupo, v_fecha_inicio, v_fecha_fin, v_tiempo_limite
        FROM EXAMEN
        WHERE ID_EXAMEN = p_id_examen;

        -- Validar que el estudiante pertenece al grupo
        SELECT COUNT(*)
        INTO v_estudiante_en_grupo
        FROM ESTUDIANTE_GRUPO
        WHERE ID_ESTUDIANTE = p_id_estudiante AND ID_GRUPO = v_id_grupo;

        IF v_estudiante_en_grupo = 0 THEN
            RAISE_APPLICATION_ERROR(-20001, 'El estudiante no pertenece al grupo de este examen.');
        END IF;

        -- Validar rango de fechas
        IF SYSDATE < v_fecha_inicio OR SYSDATE > v_fecha_fin THEN
            RAISE_APPLICATION_ERROR(-20002, 'No se puede presentar el examen fuera del rango de fechas permitido.');
        END IF;

        -- Insertar la presentación del examen
        INSERT INTO PRESENTACION_EXAMEN (
            ID_PRESENTACION,
            ID_EXAMEN,
            ID_ESTUDIANTE,
            FECHA_HORA_INICIO,
            FECHA_HORA_FIN
        ) VALUES (
            SEQ_PRESENTACION_EXAMEN.NEXTVAL,
            p_id_examen,
            p_id_estudiante,
            SYSDATE,
            SYSDATE + v_tiempo_limite / 1440
        );

        COMMIT;
    END CREAR_PRESENTACION_EXAMEN;

    -- NUEVA IMPLEMENTACIÓN
    FUNCTION OBTENER_CALIFICACION (
        p_id_presentacion IN NUMBER
    ) RETURN NUMBER
    IS
        v_calificacion NUMBER(5,2);
    BEGIN
        SELECT CALIFICACION
        INTO v_calificacion
        FROM PRESENTACION_EXAMEN
        WHERE ID_PRESENTACION = p_id_presentacion;
        
        RETURN v_calificacion;
        
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            RETURN -1;
        WHEN OTHERS THEN
            RETURN -1;
    END OBTENER_CALIFICACION;

    -- IMPLEMENTACIÓN CONTAR INTENTOS REALIZADOS
    FUNCTION CONTAR_INTENTOS_REALIZADOS (
        p_id_estudiante IN NUMBER,
        p_id_examen IN NUMBER
    ) RETURN NUMBER
    IS
        v_total NUMBER;
    BEGIN
        SELECT COUNT(*)
        INTO v_total
        FROM PRESENTACION_EXAMEN
        WHERE ID_ESTUDIANTE = p_id_estudiante 
          AND ID_EXAMEN = p_id_examen 
          AND UPPER(ESTADO) = 'FINALIZADO';
        
        RETURN v_total;
        
    EXCEPTION
        WHEN OTHERS THEN
            RETURN 0;
    END CONTAR_INTENTOS_REALIZADOS;

    -- IMPLEMENTACIÓN OBTENER INTENTOS PERMITIDOS
    FUNCTION OBTENER_INTENTOS_PERMITIDOS (
        p_id_examen IN NUMBER
    ) RETURN NUMBER
    IS
        v_intentos_permitidos NUMBER;
    BEGIN
        SELECT INTENTOS_PERMITIDOS
        INTO v_intentos_permitidos
        FROM EXAMEN
        WHERE ID_EXAMEN = p_id_examen;
        
        RETURN v_intentos_permitidos;
        
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            RETURN 1;
        WHEN OTHERS THEN
            RETURN 1;
    END OBTENER_INTENTOS_PERMITIDOS;

    -- IMPLEMENTACIÓN EXAMEN TIENE PRESENTACIONES
    FUNCTION EXAMEN_TIENE_PRESENTACIONES (
        p_id_examen IN NUMBER
    ) RETURN NUMBER
    IS
        v_count NUMBER;
    BEGIN
        SELECT COUNT(*)
        INTO v_count
        FROM PRESENTACION_EXAMEN
        WHERE ID_EXAMEN = p_id_examen;
        
        RETURN v_count;
        
    EXCEPTION
        WHEN OTHERS THEN
            RETURN 0;
    END EXAMEN_TIENE_PRESENTACIONES;

    -- IMPLEMENTACIÓN OBTENER ESTADÍSTICAS DE PRESENTACIONES
    FUNCTION OBTENER_ESTADISTICAS_PRESENTACIONES (
        p_id_examen IN NUMBER,
        p_total OUT NUMBER,
        p_finalizados OUT NUMBER,
        p_en_progreso OUT NUMBER
    ) RETURN VARCHAR2
    IS
    BEGIN
        SELECT 
            COUNT(*) as TOTAL,
            COUNT(CASE WHEN UPPER(ESTADO) = 'FINALIZADO' THEN 1 END) as FINALIZADOS,
            COUNT(CASE WHEN UPPER(ESTADO) = 'EN_PROGRESO' THEN 1 END) as EN_PROGRESO
        INTO p_total, p_finalizados, p_en_progreso
        FROM PRESENTACION_EXAMEN 
        WHERE ID_EXAMEN = p_id_examen;
        
        RETURN 'OK';
        
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            p_total := 0;
            p_finalizados := 0;
            p_en_progreso := 0;
            RETURN 'NO_DATA';
        WHEN OTHERS THEN
            p_total := 0;
            p_finalizados := 0;
            p_en_progreso := 0;
            RETURN 'ERROR';
    END OBTENER_ESTADISTICAS_PRESENTACIONES;

END PKG_PRESENTACION_EXAMEN;

/
--------------------------------------------------------
--  Constraints for Table PLAN_ESTUDIO
--------------------------------------------------------

  ALTER TABLE "ROOT2"."PLAN_ESTUDIO" MODIFY ("ID_GRUPO" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."PLAN_ESTUDIO" ADD PRIMARY KEY ("ID_PLAN")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table EXAMEN_PREGUNTA
--------------------------------------------------------

  ALTER TABLE "ROOT2"."EXAMEN_PREGUNTA" ADD CONSTRAINT "PK_EXAMEN_PREGUNTA" PRIMARY KEY ("ID_EXAMEN", "ID_PREGUNTA")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table HORARIO
--------------------------------------------------------

  ALTER TABLE "ROOT2"."HORARIO" MODIFY ("ID_GRUPO" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."HORARIO" ADD PRIMARY KEY ("ID_HORARIO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table PREGUNTA
--------------------------------------------------------

  ALTER TABLE "ROOT2"."PREGUNTA" MODIFY ("ID_PREGUNTA" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."PREGUNTA" ADD PRIMARY KEY ("ID_PREGUNTA")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
  ALTER TABLE "ROOT2"."PREGUNTA" MODIFY ("ID_TEMA" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."PREGUNTA" MODIFY ("VALOR_NOTA" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."PREGUNTA" ADD CHECK (ES_PUBLICA IN ('S', 'N')) ENABLE;
--------------------------------------------------------
--  Constraints for Table DOCENTE
--------------------------------------------------------

  ALTER TABLE "ROOT2"."DOCENTE" ADD PRIMARY KEY ("ID_DOCENTE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table USUARIO
--------------------------------------------------------

  ALTER TABLE "ROOT2"."USUARIO" ADD UNIQUE ("CORREO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
  ALTER TABLE "ROOT2"."USUARIO" ADD CHECK (tipo_usuario IN ('Docente', 'Estudiante')) ENABLE;
  ALTER TABLE "ROOT2"."USUARIO" ADD CONSTRAINT "PK_USUARIO" PRIMARY KEY ("ID_USUARIO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ESTADISTICAS_ESTUDIANTE
--------------------------------------------------------

  ALTER TABLE "ROOT2"."ESTADISTICAS_ESTUDIANTE" ADD PRIMARY KEY ("ID_ESTUDIANTE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table TEMA
--------------------------------------------------------

  ALTER TABLE "ROOT2"."TEMA" MODIFY ("NOMBRE" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."TEMA" ADD PRIMARY KEY ("ID_TEMA")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table RESPUESTA
--------------------------------------------------------

  ALTER TABLE "ROOT2"."RESPUESTA" ADD PRIMARY KEY ("ID_RESPUESTA")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ESTUDIANTE_GRUPO
--------------------------------------------------------

  ALTER TABLE "ROOT2"."ESTUDIANTE_GRUPO" ADD PRIMARY KEY ("ID_ESTUDIANTE", "ID_GRUPO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table UNIDAD
--------------------------------------------------------

  ALTER TABLE "ROOT2"."UNIDAD" MODIFY ("ID_PLAN" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."UNIDAD" ADD PRIMARY KEY ("ID_UNIDAD")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table RESPUESTA_ESTUDIANTE
--------------------------------------------------------

  ALTER TABLE "ROOT2"."RESPUESTA_ESTUDIANTE" ADD PRIMARY KEY ("ID_RESPUESTA_ESTUDIANTE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table EXAMEN
--------------------------------------------------------

  ALTER TABLE "ROOT2"."EXAMEN" MODIFY ("MODO_SELECCION" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."EXAMEN" MODIFY ("ID_GRUPO" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."EXAMEN" MODIFY ("INTENTOS_PERMITIDOS" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."EXAMEN" MODIFY ("FECHA_INICIO" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."EXAMEN" MODIFY ("FECHA_FIN" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."EXAMEN" MODIFY ("TIEMPO_LIMITE" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."EXAMEN" MODIFY ("ID_DOCENTE" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."EXAMEN" MODIFY ("NUMERO_PREGUNTAS" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."EXAMEN" MODIFY ("NOMBRE" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."EXAMEN" MODIFY ("DESCRIPCION" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."EXAMEN" ADD PRIMARY KEY ("ID_EXAMEN")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
  ALTER TABLE "ROOT2"."EXAMEN" ADD CONSTRAINT "CHK_MODO_SELECCION" CHECK (modo_seleccion IN ('Manual', 'Aleatorio', 'Mixto')) ENABLE;
  ALTER TABLE "ROOT2"."EXAMEN" MODIFY ("ID_TEMA" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table DOCENTE_GRUPO
--------------------------------------------------------

  ALTER TABLE "ROOT2"."DOCENTE_GRUPO" ADD PRIMARY KEY ("ID_DOCENTE", "ID_GRUPO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ESTADISTICAS_GRUPO
--------------------------------------------------------

  ALTER TABLE "ROOT2"."ESTADISTICAS_GRUPO" ADD PRIMARY KEY ("ID_GRUPO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ESTADISTICAS_PREGUNTA
--------------------------------------------------------

  ALTER TABLE "ROOT2"."ESTADISTICAS_PREGUNTA" ADD PRIMARY KEY ("ID_PREGUNTA")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ESTUDIANTE
--------------------------------------------------------

  ALTER TABLE "ROOT2"."ESTUDIANTE" ADD PRIMARY KEY ("ID_ESTUDIANTE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table PRESENTACION_EXAMEN
--------------------------------------------------------

  ALTER TABLE "ROOT2"."PRESENTACION_EXAMEN" ADD PRIMARY KEY ("ID_PRESENTACION")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table GRUPO
--------------------------------------------------------

  ALTER TABLE "ROOT2"."GRUPO" MODIFY ("NOMBRE" NOT NULL ENABLE);
  ALTER TABLE "ROOT2"."GRUPO" ADD PRIMARY KEY ("ID_GRUPO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ESTADISTICAS_TEMA
--------------------------------------------------------

  ALTER TABLE "ROOT2"."ESTADISTICAS_TEMA" ADD PRIMARY KEY ("ID_TEMA")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ESTADISTICAS_EXAMEN
--------------------------------------------------------

  ALTER TABLE "ROOT2"."ESTADISTICAS_EXAMEN" ADD PRIMARY KEY ("ID_ESTADISTICA")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBS_INDICES"  ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table DOCENTE
--------------------------------------------------------

  ALTER TABLE "ROOT2"."DOCENTE" ADD CONSTRAINT "FK_DOCENTE_USUARIO" FOREIGN KEY ("ID_DOCENTE")
	  REFERENCES "ROOT2"."USUARIO" ("ID_USUARIO") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table DOCENTE_GRUPO
--------------------------------------------------------

  ALTER TABLE "ROOT2"."DOCENTE_GRUPO" ADD CONSTRAINT "FK_DOCENTEGRUPO_DOCENTE" FOREIGN KEY ("ID_DOCENTE")
	  REFERENCES "ROOT2"."DOCENTE" ("ID_DOCENTE") ENABLE;
  ALTER TABLE "ROOT2"."DOCENTE_GRUPO" ADD CONSTRAINT "FK_DOCENTEGRUPO_GRUPO" FOREIGN KEY ("ID_GRUPO")
	  REFERENCES "ROOT2"."GRUPO" ("ID_GRUPO") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table ESTADISTICAS_ESTUDIANTE
--------------------------------------------------------

  ALTER TABLE "ROOT2"."ESTADISTICAS_ESTUDIANTE" ADD FOREIGN KEY ("ID_ESTUDIANTE")
	  REFERENCES "ROOT2"."ESTUDIANTE" ("ID_ESTUDIANTE") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table ESTADISTICAS_EXAMEN
--------------------------------------------------------

  ALTER TABLE "ROOT2"."ESTADISTICAS_EXAMEN" ADD FOREIGN KEY ("ID_EXAMEN")
	  REFERENCES "ROOT2"."EXAMEN" ("ID_EXAMEN") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table ESTADISTICAS_GRUPO
--------------------------------------------------------

  ALTER TABLE "ROOT2"."ESTADISTICAS_GRUPO" ADD FOREIGN KEY ("ID_GRUPO")
	  REFERENCES "ROOT2"."GRUPO" ("ID_GRUPO") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table ESTADISTICAS_PREGUNTA
--------------------------------------------------------

  ALTER TABLE "ROOT2"."ESTADISTICAS_PREGUNTA" ADD FOREIGN KEY ("ID_PREGUNTA")
	  REFERENCES "ROOT2"."PREGUNTA" ("ID_PREGUNTA") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table ESTADISTICAS_TEMA
--------------------------------------------------------

  ALTER TABLE "ROOT2"."ESTADISTICAS_TEMA" ADD FOREIGN KEY ("ID_TEMA")
	  REFERENCES "ROOT2"."TEMA" ("ID_TEMA") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table ESTUDIANTE
--------------------------------------------------------

  ALTER TABLE "ROOT2"."ESTUDIANTE" ADD CONSTRAINT "FK_ESTUDIANTE_USUARIO" FOREIGN KEY ("ID_ESTUDIANTE")
	  REFERENCES "ROOT2"."USUARIO" ("ID_USUARIO") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table ESTUDIANTE_GRUPO
--------------------------------------------------------

  ALTER TABLE "ROOT2"."ESTUDIANTE_GRUPO" ADD CONSTRAINT "FK_ESTUDIANTEGRUPO_ESTUDIANTE" FOREIGN KEY ("ID_ESTUDIANTE")
	  REFERENCES "ROOT2"."ESTUDIANTE" ("ID_ESTUDIANTE") ENABLE;
  ALTER TABLE "ROOT2"."ESTUDIANTE_GRUPO" ADD CONSTRAINT "FK_ESTUDIANTEGRUPO_GRUPO" FOREIGN KEY ("ID_GRUPO")
	  REFERENCES "ROOT2"."GRUPO" ("ID_GRUPO") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table EXAMEN
--------------------------------------------------------

  ALTER TABLE "ROOT2"."EXAMEN" ADD CONSTRAINT "FK_EXAMEN_TEMA" FOREIGN KEY ("ID_TEMA")
	  REFERENCES "ROOT2"."TEMA" ("ID_TEMA") ENABLE;
  ALTER TABLE "ROOT2"."EXAMEN" ADD CONSTRAINT "FK_EXAMEN_DOCENTE" FOREIGN KEY ("ID_DOCENTE")
	  REFERENCES "ROOT2"."DOCENTE" ("ID_DOCENTE") ENABLE;
  ALTER TABLE "ROOT2"."EXAMEN" ADD CONSTRAINT "FK_EXAMEN_GRUPO" FOREIGN KEY ("ID_GRUPO")
	  REFERENCES "ROOT2"."GRUPO" ("ID_GRUPO") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table EXAMEN_PREGUNTA
--------------------------------------------------------

  ALTER TABLE "ROOT2"."EXAMEN_PREGUNTA" ADD FOREIGN KEY ("ID_EXAMEN")
	  REFERENCES "ROOT2"."EXAMEN" ("ID_EXAMEN") ENABLE;
  ALTER TABLE "ROOT2"."EXAMEN_PREGUNTA" ADD FOREIGN KEY ("ID_PREGUNTA")
	  REFERENCES "ROOT2"."PREGUNTA" ("ID_PREGUNTA") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table HORARIO
--------------------------------------------------------

  ALTER TABLE "ROOT2"."HORARIO" ADD FOREIGN KEY ("ID_GRUPO")
	  REFERENCES "ROOT2"."GRUPO" ("ID_GRUPO") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table PLAN_ESTUDIO
--------------------------------------------------------

  ALTER TABLE "ROOT2"."PLAN_ESTUDIO" ADD FOREIGN KEY ("ID_GRUPO")
	  REFERENCES "ROOT2"."GRUPO" ("ID_GRUPO") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table PREGUNTA
--------------------------------------------------------

  ALTER TABLE "ROOT2"."PREGUNTA" ADD CONSTRAINT "FK_PREGUNTA_TEMA" FOREIGN KEY ("ID_TEMA")
	  REFERENCES "ROOT2"."TEMA" ("ID_TEMA") ENABLE;
  ALTER TABLE "ROOT2"."PREGUNTA" ADD CONSTRAINT "FK_DOCENTE_PREGUNTA" FOREIGN KEY ("ID_DOCENTE")
	  REFERENCES "ROOT2"."DOCENTE" ("ID_DOCENTE") ENABLE;
  ALTER TABLE "ROOT2"."PREGUNTA" ADD CONSTRAINT "FK_PREGUNTA_PADRE" FOREIGN KEY ("ID_PREGUNTA_PADRE")
	  REFERENCES "ROOT2"."PREGUNTA" ("ID_PREGUNTA") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table PRESENTACION_EXAMEN
--------------------------------------------------------

  ALTER TABLE "ROOT2"."PRESENTACION_EXAMEN" ADD FOREIGN KEY ("ID_EXAMEN")
	  REFERENCES "ROOT2"."EXAMEN" ("ID_EXAMEN") ENABLE;
  ALTER TABLE "ROOT2"."PRESENTACION_EXAMEN" ADD CONSTRAINT "FK_PRESENTACION_ESTUDIANTE" FOREIGN KEY ("ID_ESTUDIANTE")
	  REFERENCES "ROOT2"."ESTUDIANTE" ("ID_ESTUDIANTE") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table RESPUESTA
--------------------------------------------------------

  ALTER TABLE "ROOT2"."RESPUESTA" ADD FOREIGN KEY ("ID_PREGUNTA")
	  REFERENCES "ROOT2"."PREGUNTA" ("ID_PREGUNTA") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table RESPUESTA_ESTUDIANTE
--------------------------------------------------------

  ALTER TABLE "ROOT2"."RESPUESTA_ESTUDIANTE" ADD FOREIGN KEY ("ID_PRESENTACION")
	  REFERENCES "ROOT2"."PRESENTACION_EXAMEN" ("ID_PRESENTACION") ENABLE;
  ALTER TABLE "ROOT2"."RESPUESTA_ESTUDIANTE" ADD FOREIGN KEY ("ID_PREGUNTA")
	  REFERENCES "ROOT2"."PREGUNTA" ("ID_PREGUNTA") ENABLE;
  ALTER TABLE "ROOT2"."RESPUESTA_ESTUDIANTE" ADD FOREIGN KEY ("ID_RESPUESTA")
	  REFERENCES "ROOT2"."RESPUESTA" ("ID_RESPUESTA") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table TEMA
--------------------------------------------------------

  ALTER TABLE "ROOT2"."TEMA" ADD CONSTRAINT "FK_TEMA_UNIDAD" FOREIGN KEY ("ID_UNIDAD")
	  REFERENCES "ROOT2"."UNIDAD" ("ID_UNIDAD") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table UNIDAD
--------------------------------------------------------

  ALTER TABLE "ROOT2"."UNIDAD" ADD FOREIGN KEY ("ID_PLAN")
	  REFERENCES "ROOT2"."PLAN_ESTUDIO" ("ID_PLAN") ENABLE;
